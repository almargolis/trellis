{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Welcome to Trellis","text":"<p>Trellis is a Flask-based digital garden and hierarchical content management system designed to help you quickly create and maintain a personal blog or knowledge base.</p>"},{"location":"#what-is-trellis","title":"What is Trellis?","text":"<p>Trellis provides a simple, markdown-based platform for organizing your thoughts, writing blog posts, and building interconnected knowledge gardens. Like a garden trellis that supports and organizes growing plants, Trellis provides a framework for organizing and growing your digital content.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>Fast Setup - Get a digital garden running in minutes</li> <li>Markdown-Based - Write in plain markdown with YAML frontmatter</li> <li>Hierarchical Organization - Organize content in nested directories</li> <li>Full-Text Search - Built-in search powered by Whoosh</li> <li>Wiki-Style Links - Easy cross-referencing between pages with <code>[[Page Title]]</code> syntax</li> <li>Git Integration - Automatic version control for your content</li> <li>Web Editor - Built-in interface for editing without leaving your browser</li> <li>Flexible Structure - Support for both flat files and nested page directories</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":"<p>Ready to get started? Head to the Quick Start Guide to create your first digital garden in under 5 minutes.</p>"},{"location":"#use-cases","title":"Use Cases","text":"<p>Personal Blog - Share your thoughts and ideas with the world</p> <p>Knowledge Base - Build an interconnected collection of notes and articles</p> <p>Project Documentation - Document your projects with hierarchical structure</p> <p>Digital Garden - Cultivate a growing collection of evolving ideas</p>"},{"location":"#community-support","title":"Community &amp; Support","text":"<ul> <li>GitHub: almargolis/trellis</li> <li>Issues: Report bugs or request features</li> <li>License: MIT - free for personal and commercial use</li> </ul>"},{"location":"#next-steps","title":"Next Steps","text":"<ol> <li>Quick Start - Get your site running</li> <li>Writing Content - Learn markdown basics</li> <li>Backup Strategy - Protect your content</li> </ol>"},{"location":"content/page-directories/","title":"Page Directories","text":"<p>Hierarchical content organization with nested pages and assets.</p>"},{"location":"content/page-directories/#what-are-page-directories","title":"What Are Page Directories?","text":"<p>Page directories (ending in <code>.page</code>) allow you to organize complex content hierarchically with related files kept together.</p>"},{"location":"content/page-directories/#flat-file","title":"Flat File","text":"<pre><code>content/\n  blog/\n    article.md\n</code></pre>"},{"location":"content/page-directories/#page-directory","title":"Page Directory","text":"<pre><code>content/\n  blog/\n    article.page/\n      page.md\n      image.png\n      code-example.py\n</code></pre> <p>Both create the same URL: <code>/garden/blog/article</code></p>"},{"location":"content/page-directories/#why-use-page-directories","title":"Why Use Page Directories?","text":"<p>Keep assets together: <pre><code>my-project.page/\n  page.md\n  screenshot.png\n  demo.gif\n  architecture.svg\n</code></pre></p> <p>Nest related content: <pre><code>my-project.page/\n  page.md\n  getting-started.page/\n    page.md\n  advanced-usage.page/\n    page.md\n</code></pre></p> <p>Include external files: <pre><code>tutorial.page/\n  page.md\n  example.py\n  config.yaml\n</code></pre></p>"},{"location":"content/page-directories/#basic-structure","title":"Basic Structure","text":""},{"location":"content/page-directories/#single-page","title":"Single Page","text":"<pre><code>content/\n  projects/\n    my-app.page/\n      page.md         # Main content (required)\n      screenshot.png  # Page asset\n</code></pre> <p>The <code>page.md</code> file contains your markdown content with frontmatter:</p> <pre><code>---\ntitle: My App\npublished_date: 2026-01-09\n---\n\nThis is my app.\n\n![Screenshot](screenshot.png)\n</code></pre> <p>URL: <code>/garden/projects/my-app</code></p>"},{"location":"content/page-directories/#nested-pages","title":"Nested Pages","text":"<pre><code>content/\n  projects/\n    my-app.page/\n      page.md                    # /garden/projects/my-app\n      getting-started.page/\n        page.md                  # /garden/projects/my-app/getting-started\n      api-reference.page/\n        page.md                  # /garden/projects/my-app/api-reference\n        authentication.page/\n          page.md                # /garden/projects/my-app/api-reference/authentication\n</code></pre> <p>Unlimited nesting depth!</p>"},{"location":"content/page-directories/#using-assets","title":"Using Assets","text":""},{"location":"content/page-directories/#images","title":"Images","text":"<p>Store images alongside your content:</p> <pre><code>article.page/\n  page.md\n  diagram.png\n  photo.jpg\n</code></pre> <p>Reference them in markdown:</p> <pre><code>![Diagram](diagram.png)\n![Photo](photo.jpg)\n</code></pre> <p>Trellis serves assets at: <code>/garden/&lt;garden&gt;/&lt;path&gt;/assets/&lt;filename&gt;</code></p>"},{"location":"content/page-directories/#other-files","title":"Other Files","text":"<p>Store any file type:</p> <pre><code>project.page/\n  page.md\n  config.json\n  example.py\n  data.csv\n  presentation.pdf\n</code></pre> <p>Link to them:</p> <pre><code>Download the [config file](config.json) or\nview the [example code](example.py).\n</code></pre>"},{"location":"content/page-directories/#include-files","title":"Include Files","text":"<p>Include external files in your content:</p> <pre><code>{{include: example.py}}\n</code></pre> <p>This inserts the contents of <code>example.py</code> into your markdown before rendering.</p>"},{"location":"content/page-directories/#example-structure","title":"Example Structure","text":"<pre><code>tutorial.page/\n  page.md\n  hello.py\n  advanced.py\n</code></pre> <p>In <code>page.md</code>:</p> <pre><code>---\ntitle: Python Tutorial\n---\n\nHere's a simple example:\n\n{{include: hello.py}}\n\nAnd here's an advanced version:\n\n{{include: advanced.py}}\n</code></pre>"},{"location":"content/page-directories/#syntax-highlighting","title":"Syntax Highlighting","text":"<p>Wrap includes in code blocks for syntax highlighting:</p> <pre><code>```python\n{{include: example.py}}\n```\n</code></pre>"},{"location":"content/page-directories/#include-paths","title":"Include Paths","text":"<p>Includes are resolved relative to the directory containing <code>page.md</code>:</p> <pre><code>project.page/\n  page.md\n  code/\n    example.py\n  docs/\n    api.md\n</code></pre> <p>In <code>page.md</code>: <pre><code>{{include: code/example.py}}\n{{include: docs/api.md}}\n</code></pre></p>"},{"location":"content/page-directories/#hierarchical-organization","title":"Hierarchical Organization","text":""},{"location":"content/page-directories/#documentation-site","title":"Documentation Site","text":"<pre><code>content/\n  docs/\n    introduction.page/\n      page.md\n    installation.page/\n      page.md\n      linux.page/\n        page.md\n      macos.page/\n        page.md\n      windows.page/\n        page.md\n    guide.page/\n      page.md\n      basics.page/\n        page.md\n      advanced.page/\n        page.md\n</code></pre> <p>URLs: - <code>/garden/docs/introduction</code> - <code>/garden/docs/installation</code> - <code>/garden/docs/installation/linux</code> - <code>/garden/docs/installation/macos</code> - <code>/garden/docs/installation/windows</code> - <code>/garden/docs/guide</code> - <code>/garden/docs/guide/basics</code> - <code>/garden/docs/guide/advanced</code></p>"},{"location":"content/page-directories/#project-portfolio","title":"Project Portfolio","text":"<pre><code>content/\n  projects/\n    web-app.page/\n      page.md\n      screenshots/\n        home.png\n        dashboard.png\n      architecture.page/\n        page.md\n        diagram.svg\n      deployment.page/\n        page.md\n        docker-compose.yml\n    cli-tool.page/\n      page.md\n      demo.gif\n</code></pre>"},{"location":"content/page-directories/#tutorial-series","title":"Tutorial Series","text":"<pre><code>content/\n  tutorials/\n    python-basics.page/\n      page.md\n      lesson-1.page/\n        page.md\n        exercise.py\n        solution.py\n      lesson-2.page/\n        page.md\n        exercise.py\n        solution.py\n      lesson-3.page/\n        page.md\n</code></pre>"},{"location":"content/page-directories/#breadcrumb-navigation","title":"Breadcrumb Navigation","text":"<p>Trellis automatically generates breadcrumbs for nested pages:</p> <p>URL: <code>/garden/docs/guide/advanced</code></p> <p>Breadcrumbs: <pre><code>Home &gt; Docs &gt; Guide &gt; Advanced\n</code></pre></p> <p>Each breadcrumb is clickable and navigates to the parent page.</p>"},{"location":"content/page-directories/#mixed-structure","title":"Mixed Structure","text":"<p>You can mix flat files and page directories:</p> <pre><code>content/\n  blog/\n    simple-post.md              # Flat file\n    complex-post.page/          # Page directory\n      page.md\n      images/\n        photo.png\n    another-simple-post.md      # Flat file\n</code></pre> <p>Use flat files for simple articles, page directories for complex ones.</p>"},{"location":"content/page-directories/#converting-between-formats","title":"Converting Between Formats","text":""},{"location":"content/page-directories/#flat-to-page-directory","title":"Flat to Page Directory","text":"<pre><code># Before\ncontent/blog/article.md\n\n# After\nmkdir content/blog/article.page\nmv content/blog/article.md content/blog/article.page/page.md\n</code></pre> <p>URLs remain the same!</p>"},{"location":"content/page-directories/#page-directory-to-flat","title":"Page Directory to Flat","text":"<pre><code># Before\ncontent/blog/article.page/page.md\n\n# After\nmv content/blog/article.page/page.md content/blog/article.md\nrm -r content/blog/article.page\n</code></pre> <p>Warning: This removes assets and includes. Make sure they're not needed.</p>"},{"location":"content/page-directories/#best-practices","title":"Best Practices","text":"<p>Use for complex content: - Multi-file projects - Content with many images - Tutorials with code examples - Documentation with includes</p> <p>Keep it simple: - Don't nest unnecessarily - Use flat files for simple articles - Only create page directories when you need them</p> <p>Organize assets: <pre><code>project.page/\n  page.md\n  images/\n    screenshot1.png\n    screenshot2.png\n  code/\n    example1.py\n    example2.py\n</code></pre></p> <p>Name descriptively: <pre><code># Good\ngetting-started.page/\ninstallation-guide.page/\n\n# Less good\ngs.page/\ninstall.page/\n</code></pre></p> <p>Plan hierarchy: - Sketch your content tree before creating - Group related content together - Keep hierarchy shallow (2-3 levels is usually enough)</p>"},{"location":"content/page-directories/#limitations","title":"Limitations","text":"<p>Asset paths: - Assets are served at <code>/garden/&lt;garden&gt;/&lt;path&gt;/assets/&lt;filename&gt;</code> - Use relative paths in markdown: <code>![](image.png)</code> - Don't use absolute paths: <code>![](/assets/image.png)</code> won't work</p> <p>Include files: - Resolved relative to <code>page.md</code> location - Can only include files within the same <code>.page</code> directory tree - Can't include files from other gardens</p> <p>URL structure: - <code>.page</code> extension is stripped from URLs - <code>/article.page/page.md</code> \u2192 <code>/article</code> - Can't have <code>article.md</code> and <code>article.page/</code> in the same directory</p>"},{"location":"content/page-directories/#technical-details","title":"Technical Details","text":""},{"location":"content/page-directories/#file-detection","title":"File Detection","text":"<p>Trellis detects page directories by: 1. Looking for directories ending in <code>.page</code> 2. Checking for <code>page.md</code> inside 3. Serving <code>page.md</code> as the page content</p>"},{"location":"content/page-directories/#asset-serving","title":"Asset Serving","text":"<p>Assets are served via the <code>page_asset()</code> route:</p> <pre><code>@main_bp.route('/garden/&lt;garden_slug&gt;/&lt;path:article_path&gt;/assets/&lt;filename&gt;')\ndef page_asset(garden_slug, article_path, filename):\n    # Serves files from the .page directory\n    ...\n</code></pre> <p>Path validation prevents directory traversal attacks.</p>"},{"location":"content/page-directories/#include-processing","title":"Include Processing","text":"<p>Includes are processed by <code>MarkdownHandler._process_includes()</code>:</p> <ol> <li>Find <code>{{include: filename}}</code> patterns</li> <li>Resolve path relative to <code>page.md</code></li> <li>Read file contents</li> <li>Replace pattern with contents</li> <li>Continue with markdown rendering</li> </ol>"},{"location":"content/page-directories/#troubleshooting","title":"Troubleshooting","text":"<p>Images not loading?</p> <p>Check: - Image is in the same directory as <code>page.md</code> - Using relative path: <code>![](image.png)</code> not <code>![](/image.png)</code> - Image file exists and has correct name</p> <p>Include not working?</p> <p>Check: - Include file exists in the <code>.page</code> directory - Path is relative: <code>{{include: file.py}}</code> not <code>{{include: /file.py}}</code> - Syntax is exact: <code>{{include: filename}}</code> with colon and space</p> <p>404 on nested pages?</p> <p>Check: - Each level has <code>.page</code> extension: <code>parent.page/child.page/</code> - Each level has <code>page.md</code> file - Rebuild content index: <code>trellis-search --rebuild</code></p>"},{"location":"content/page-directories/#next-steps","title":"Next Steps","text":"<ul> <li>Writing Content - Markdown and frontmatter</li> <li>Content Structure - Organizing gardens</li> <li>Wiki Links - Internal linking</li> </ul>"},{"location":"content/structure/","title":"Content Structure","text":"<p>How to organize content across multiple gardens and topics.</p>"},{"location":"content/structure/#directory-layout","title":"Directory Layout","text":"<p>Trellis uses a hierarchical directory structure:</p> <pre><code>content/\n  garden-1/\n    config.yaml\n    article-1.md\n    article-2.md\n  garden-2/\n    config.yaml\n    article-1.md\n    nested.page/\n      page.md\n      assets/\n        image.png\n</code></pre>"},{"location":"content/structure/#gardens","title":"Gardens","text":"<p>A garden is a top-level directory under <code>content/</code>. Each garden represents a distinct collection of content.</p>"},{"location":"content/structure/#creating-a-garden","title":"Creating a Garden","text":"<pre><code>mkdir content/my-garden\n</code></pre> <p>Create <code>content/my-garden/config.yaml</code>:</p> <pre><code>title: My Garden\ndescription: Brief description of this garden\ncreated_date: 2026-01-09\norder: 1\n</code></pre>"},{"location":"content/structure/#garden-configuration","title":"Garden Configuration","text":"<p>Required fields: - <code>title</code>: Display name - <code>description</code>: Brief description</p> <p>Optional fields: - <code>created_date</code>: When you created this garden - <code>order</code>: Sort order (lower numbers first, default: 999)</p>"},{"location":"content/structure/#example-garden-structures","title":"Example Garden Structures","text":"<p>Personal Blog: <pre><code>content/\n  blog/\n    config.yaml\n    welcome.md\n    python-tips.md\n    book-review.md\n</code></pre></p> <p>Multiple Topics: <pre><code>content/\n  tech/\n    config.yaml\n    python-tutorial.md\n    web-development.md\n  personal/\n    config.yaml\n    thoughts.md\n    travel.md\n  projects/\n    config.yaml\n    my-app.md\n    another-project.md\n</code></pre></p> <p>Documentation Site: <pre><code>content/\n  guides/\n    config.yaml\n    getting-started.md\n    installation.md\n  api/\n    config.yaml\n    endpoints.md\n    authentication.md\n  examples/\n    config.yaml\n    basic-usage.md\n    advanced.md\n</code></pre></p>"},{"location":"content/structure/#article-files","title":"Article Files","text":""},{"location":"content/structure/#flat-files","title":"Flat Files","text":"<p>Standard markdown files in a garden directory:</p> <pre><code>content/\n  blog/\n    article-1.md\n    article-2.md\n</code></pre> <p>URL mapping: - <code>content/blog/article-1.md</code> \u2192 <code>/garden/blog/article-1</code></p>"},{"location":"content/structure/#page-directories","title":"Page Directories","text":"<p>Directories ending in <code>.page</code> with a <code>page.md</code> file inside:</p> <pre><code>content/\n  projects/\n    my-project.page/\n      page.md\n      screenshot.png\n      setup.page/\n        page.md\n</code></pre> <p>URL mapping: - <code>content/projects/my-project.page/page.md</code> \u2192 <code>/garden/projects/my-project</code> - <code>content/projects/my-project.page/setup.page/page.md</code> \u2192 <code>/garden/projects/my-project/setup</code></p> <p>See Page Directories for details.</p>"},{"location":"content/structure/#organizing-content","title":"Organizing Content","text":""},{"location":"content/structure/#by-topic","title":"By Topic","text":"<p>Group related content:</p> <pre><code>content/\n  python/\n    config.yaml\n    basics.md\n    advanced.md\n    libraries.md\n  javascript/\n    config.yaml\n    intro.md\n    frameworks.md\n</code></pre>"},{"location":"content/structure/#by-content-type","title":"By Content Type","text":"<p>Separate different types of content:</p> <pre><code>content/\n  articles/\n    config.yaml\n    essay-1.md\n    essay-2.md\n  tutorials/\n    config.yaml\n    tutorial-1.md\n    tutorial-2.md\n  projects/\n    config.yaml\n    project-1.page/\n      page.md\n</code></pre>"},{"location":"content/structure/#by-time-period","title":"By Time Period","text":"<p>Organize chronologically:</p> <pre><code>content/\n  2025/\n    config.yaml\n    january-post.md\n    february-post.md\n  2026/\n    config.yaml\n    january-post.md\n</code></pre>"},{"location":"content/structure/#hybrid-approach","title":"Hybrid Approach","text":"<p>Combine strategies:</p> <pre><code>content/\n  blog/\n    config.yaml\n    2025/\n      post-1.md\n      post-2.md\n    2026/\n      post-1.md\n  projects/\n    config.yaml\n    web-apps/\n      app-1.page/\n      app-2.page/\n    cli-tools/\n      tool-1.page/\n</code></pre>"},{"location":"content/structure/#garden-order","title":"Garden Order","text":"<p>Control the order gardens appear:</p> <pre><code># content/important/config.yaml\ntitle: Important Garden\norder: 1\n\n# content/less-important/config.yaml\ntitle: Less Important Garden\norder: 2\n\n# content/archived/config.yaml\ntitle: Archived Content\norder: 999\n</code></pre> <p>Lower <code>order</code> values appear first. Default is 999.</p>"},{"location":"content/structure/#url-structure","title":"URL Structure","text":""},{"location":"content/structure/#simple-urls","title":"Simple URLs","text":"<pre><code>https://yoursite.com/garden/blog/article-name\nhttps://yoursite.com/garden/projects/my-project\n</code></pre>"},{"location":"content/structure/#nested-urls","title":"Nested URLs","text":"<pre><code>https://yoursite.com/garden/projects/my-app/setup\nhttps://yoursite.com/garden/projects/my-app/setup/advanced\n</code></pre> <p>URLs are derived from: 1. Garden name (directory name) 2. Article path (filename without <code>.md</code> or <code>.page</code>)</p>"},{"location":"content/structure/#navigation","title":"Navigation","text":"<p>Trellis automatically generates:</p> <p>Garden Index (<code>/</code>): - Lists all gardens - Sorted by <code>order</code> field - Shows title and description</p> <p>Garden View (<code>/garden/&lt;garden-name&gt;</code>): - Lists all articles in the garden - Sorted by <code>published_date</code> (newest first) - Shows article titles and excerpts</p> <p>Article View (<code>/garden/&lt;garden&gt;/&lt;article&gt;</code>): - Shows full article content - Displays metadata (date, tags) - Includes breadcrumb navigation</p>"},{"location":"content/structure/#search","title":"Search","text":"<p>The search function indexes: - Article titles - Article content - Tags - Garden names</p> <p>All published content is searchable across all gardens.</p>"},{"location":"content/structure/#best-practices","title":"Best Practices","text":"<p>Start simple: - Begin with 1-2 gardens - Add more as your content grows - Don't over-organize early</p> <p>Be consistent: - Use consistent naming conventions - Follow the same structure within gardens - Tag articles consistently</p> <p>Use descriptive names: - Garden directories: <code>python-tutorials</code> not <code>pt</code> - Article files: <code>getting-started.md</code> not <code>gs.md</code></p> <p>Plan for growth: - Leave room for expansion - Use page directories for complex topics - Consider future organization needs</p> <p>Leverage hierarchy: - Use page directories for related content - Group sub-topics under main topics - Create logical content trees</p>"},{"location":"content/structure/#migrating-content","title":"Migrating Content","text":""},{"location":"content/structure/#from-flat-to-page-directories","title":"From Flat to Page Directories","text":"<p>Convert a flat article to a page directory:</p> <pre><code># Before\ncontent/blog/article.md\n\n# After\ncontent/blog/article.page/\n  page.md\n</code></pre> <p>Move <code>article.md</code> to <code>article.page/page.md</code>. URLs remain the same.</p>"},{"location":"content/structure/#reorganizing-gardens","title":"Reorganizing Gardens","text":"<p>Move articles between gardens:</p> <pre><code>mv content/old-garden/article.md content/new-garden/article.md\n</code></pre> <p>Update any wiki-links that reference the moved article.</p>"},{"location":"content/structure/#splitting-large-gardens","title":"Splitting Large Gardens","text":"<p>Break a large garden into multiple smaller ones:</p> <pre><code># Before\ncontent/blog/\n  article-1.md\n  article-2.md\n  article-3.md\n\n# After\ncontent/tech-blog/\n  article-1.md\ncontent/personal-blog/\n  article-2.md\n  article-3.md\n</code></pre> <p>Update garden configs and wiki-links.</p>"},{"location":"content/structure/#next-steps","title":"Next Steps","text":"<ul> <li>Writing Content - Markdown and formatting</li> <li>Wiki Links - Internal linking</li> <li>Page Directories - Hierarchical structure</li> </ul>"},{"location":"content/wiki-links/","title":"Wiki Links","text":"<p>Easy internal linking with wiki-style syntax.</p>"},{"location":"content/wiki-links/#what-are-wiki-links","title":"What Are Wiki Links?","text":"<p>Wiki links provide a simple way to link between articles using double brackets:</p> <pre><code>[[Article Title]]\n</code></pre> <p>This is easier than: <pre><code>[Article Title](/garden/blog/article-title)\n</code></pre></p>"},{"location":"content/wiki-links/#basic-syntax","title":"Basic Syntax","text":""},{"location":"content/wiki-links/#link-by-title","title":"Link by Title","text":"<pre><code>See [[Getting Started]] for more information.\n</code></pre> <p>Trellis finds the article with title \"Getting Started\" and creates the link automatically.</p>"},{"location":"content/wiki-links/#link-by-slug","title":"Link by Slug","text":"<pre><code>Check out [[python-tutorial]] for details.\n</code></pre> <p>You can use the article's URL slug instead of the full title.</p>"},{"location":"content/wiki-links/#custom-display-text","title":"Custom Display Text","text":"<pre><code>Learn more about [[Python Tutorial|Python]].\n</code></pre> <p>Shows \"Python\" but links to \"Python Tutorial\".</p>"},{"location":"content/wiki-links/#how-it-works","title":"How It Works","text":"<p>When you use a wiki link, Trellis:</p> <ol> <li>Searches for articles with matching titles (case-insensitive)</li> <li>Falls back to URL slug matching</li> <li>Resolves the link to the correct URL</li> <li>Converts to standard markdown: <code>[text](url)</code></li> </ol>"},{"location":"content/wiki-links/#examples","title":"Examples","text":""},{"location":"content/wiki-links/#simple-references","title":"Simple References","text":"<pre><code>This article builds on [[Previous Article]].\n\nFor background, see [[Introduction to Python]].\n</code></pre>"},{"location":"content/wiki-links/#with-custom-text","title":"With Custom Text","text":"<pre><code>We discussed this [[Advanced Concepts|earlier]].\n\nLearn about [[Python Virtual Environments|venvs]] first.\n</code></pre>"},{"location":"content/wiki-links/#multiple-links","title":"Multiple Links","text":"<pre><code>Related articles: [[Article 1]], [[Article 2]], and [[Article 3]].\n</code></pre>"},{"location":"content/wiki-links/#garden-specific-links","title":"Garden-Specific Links","text":"<p>Specify the garden for disambiguation:</p> <pre><code>[[tech/article-name]]\n[[blog/another-article]]\n</code></pre> <p>This is useful when multiple articles have similar titles in different gardens.</p>"},{"location":"content/wiki-links/#broken-links","title":"Broken Links","text":"<p>If a wiki link can't be resolved:</p> <pre><code>[[Nonexistent Article]]\n</code></pre> <p>It appears with red styling and a dashed underline, preserving the original <code>[[...]]</code> syntax so you can easily identify and fix broken links.</p>"},{"location":"content/wiki-links/#benefits","title":"Benefits","text":"<p>Resilient to Refactoring: - Rename files without breaking links - Move articles between gardens - Links resolve by title, not URL</p> <p>Easy to Write: - No need to look up URLs - Faster than typing full markdown links - More readable in source</p> <p>Knowledge Graph: - Build interconnected content - Create topic clusters - Discover related content</p>"},{"location":"content/wiki-links/#use-cases","title":"Use Cases","text":""},{"location":"content/wiki-links/#cross-references","title":"Cross-References","text":"<pre><code>---\ntitle: Python Functions\n---\n\nFor more on this topic, see [[Python Classes]] and [[Python Modules]].\n\n## Advanced Usage\n\nLearn about [[Decorators]] and [[Generators]].\n</code></pre>"},{"location":"content/wiki-links/#series-articles","title":"Series Articles","text":"<pre><code>---\ntitle: Python Tutorial - Part 2\n---\n\nPrevious: [[Python Tutorial - Part 1]]\nNext: [[Python Tutorial - Part 3]]\n</code></pre>"},{"location":"content/wiki-links/#topic-hubs","title":"Topic Hubs","text":"<pre><code>---\ntitle: Python Resources\n---\n\n## Getting Started\n- [[Installing Python]]\n- [[First Python Program]]\n- [[Python Basics]]\n\n## Intermediate\n- [[Python Functions]]\n- [[Python Classes]]\n- [[Python Modules]]\n\n## Advanced\n- [[Python Decorators]]\n- [[Python Generators]]\n- [[Python Metaclasses]]\n</code></pre>"},{"location":"content/wiki-links/#backlinks-manual","title":"Backlinks (Manual)","text":"<p>Create \"See Also\" sections:</p> <pre><code>## Related Articles\n\n- [[Related Topic 1]]\n- [[Related Topic 2]]\n- [[Related Topic 3]]\n</code></pre>"},{"location":"content/wiki-links/#best-practices","title":"Best Practices","text":"<p>Use descriptive titles: <pre><code># Good\n[[Python Virtual Environments]]\n\n# Less good\n[[Venv]]\n</code></pre></p> <p>Be consistent: - Use the same title/slug format throughout - Don't alternate between title and slug unnecessarily</p> <p>Link generously: - Create connections between related content - Build topic clusters - Help readers discover related articles</p> <p>Check broken links: - Broken links appear in red with dashed underline - Fix them by correcting the title or creating the target article</p> <p>Update after refactoring: - If you rename an article, update wiki-links that reference it - Use search to find all references: <code>grep -r \"\\[\\[Old Title\\]\\]\" content/</code></p>"},{"location":"content/wiki-links/#technical-details","title":"Technical Details","text":""},{"location":"content/wiki-links/#resolution-order","title":"Resolution Order","text":"<p>Trellis resolves wiki links in this order:</p> <ol> <li>Exact title match (case-insensitive)</li> <li> <p><code>[[Python Tutorial]]</code> \u2192 finds article with <code>title: Python Tutorial</code></p> </li> <li> <p>URL slug match</p> </li> <li> <p><code>[[python-tutorial]]</code> \u2192 finds article at <code>/garden/*/python-tutorial</code></p> </li> <li> <p>Garden-specific slug</p> </li> <li> <p><code>[[blog/python-tutorial]]</code> \u2192 finds article at <code>/garden/blog/python-tutorial</code></p> </li> <li> <p>Fuzzy title match (fallback)</p> </li> <li>Tries partial matches if exact match fails</li> </ol>"},{"location":"content/wiki-links/#performance","title":"Performance","text":"<p>Wiki links are resolved at render time using: - In-memory content index (<code>trellis_content.db</code>) - Fast SQLite lookups - Cached results</p> <p>This is much faster than scanning the filesystem for each link.</p>"},{"location":"content/wiki-links/#indexing","title":"Indexing","text":"<p>For wiki links to work, your content must be indexed:</p> <pre><code>trellis-search --rebuild\n</code></pre> <p>This builds the content index used for link resolution.</p>"},{"location":"content/wiki-links/#troubleshooting","title":"Troubleshooting","text":"<p>Links not resolving?</p> <p>Rebuild the content index: <pre><code>trellis-search --rebuild\n</code></pre></p> <p>Links to wrong article?</p> <p>Use more specific syntax: <pre><code>[[garden-name/article-slug]]\n</code></pre></p> <p>Want to use <code>[[</code> literally?</p> <p>Escape with backslash: <pre><code>Use \\[\\[double brackets\\]\\] for wiki links.\n</code></pre></p>"},{"location":"content/wiki-links/#comparison-with-standard-links","title":"Comparison with Standard Links","text":"<p>Wiki links: <pre><code>[[Article Title]]\n</code></pre></p> <p>\u2705 Resilient to refactoring \u2705 Easy to write \u2705 Title-based (human-friendly) \u274c Requires content index \u274c Broken if article doesn't exist</p> <p>Standard markdown links: <pre><code>[Article Title](/garden/blog/article-title)\n</code></pre></p> <p>\u2705 Always work (no index needed) \u2705 Explicit URLs \u2705 Standard markdown \u274c Break if URLs change \u274c More verbose \u274c Harder to maintain</p> <p>Recommendation: Use wiki links for internal references, standard markdown links for external URLs.</p>"},{"location":"content/wiki-links/#next-steps","title":"Next Steps","text":"<ul> <li>Writing Content - Markdown basics</li> <li>Content Structure - Organizing gardens</li> <li>Page Directories - Hierarchical content</li> </ul>"},{"location":"content/writing/","title":"Writing Content","text":"<p>Comprehensive guide to writing and formatting content in Trellis.</p>"},{"location":"content/writing/#markdown-basics","title":"Markdown Basics","text":"<p>Trellis uses standard markdown with extensions.</p>"},{"location":"content/writing/#headers","title":"Headers","text":"<pre><code># H1 Header\n## H2 Header\n### H3 Header\n#### H4 Header\n</code></pre>"},{"location":"content/writing/#text-formatting","title":"Text Formatting","text":"<pre><code>**Bold text**\n*Italic text*\n***Bold and italic***\n~~Strikethrough~~\n`inline code`\n</code></pre>"},{"location":"content/writing/#lists","title":"Lists","text":"<p>Unordered: <pre><code>- Item one\n- Item two\n  - Nested item\n  - Another nested item\n- Item three\n</code></pre></p> <p>Ordered: <pre><code>1. First item\n2. Second item\n3. Third item\n</code></pre></p>"},{"location":"content/writing/#links","title":"Links","text":"<pre><code>[Link text](https://example.com)\n[Link with title](https://example.com \"Hover text\")\n\n# Internal links using wiki-style\n[[Article Title]]\n[[Article Title|Custom Text]]\n</code></pre>"},{"location":"content/writing/#images","title":"Images","text":"<pre><code>![Alt text](/path/to/image.png)\n![Alt text](https://example.com/image.png \"Image title\")\n</code></pre> <p>For page-specific images, see Page Directories.</p>"},{"location":"content/writing/#code-blocks","title":"Code Blocks","text":"<p>With syntax highlighting:</p> <pre><code>```python\ndef hello_world():\n    print(\"Hello, World!\")\n```\n\n```javascript\nfunction hello() {\n    console.log(\"Hello, World!\");\n}\n```\n</code></pre>"},{"location":"content/writing/#quotes","title":"Quotes","text":"<pre><code>&gt; This is a blockquote.\n&gt; It can span multiple lines.\n&gt;\n&gt; And have multiple paragraphs.\n</code></pre>"},{"location":"content/writing/#tables","title":"Tables","text":"<pre><code>| Header 1 | Header 2 | Header 3 |\n|----------|----------|----------|\n| Row 1    | Data     | More     |\n| Row 2    | Data     | More     |\n</code></pre>"},{"location":"content/writing/#horizontal-rules","title":"Horizontal Rules","text":"<pre><code>---\n</code></pre>"},{"location":"content/writing/#frontmatter","title":"Frontmatter","text":"<p>Every article needs YAML frontmatter at the top:</p> <pre><code>---\ntitle: Article Title\npublished_date: 2026-01-09\ncreated_date: 2026-01-08\nupdated_date: 2026-01-09\ntags: [python, tutorial, web]\nstatus: published\ndescription: Brief description for SEO\n---\n\nYour content starts here...\n</code></pre>"},{"location":"content/writing/#frontmatter-fields","title":"Frontmatter Fields","text":"<p>Required: - <code>title</code>: Article title (shown in navigation and page header) - <code>status</code>: Either <code>published</code> or <code>draft</code></p> <p>Optional: - <code>published_date</code>: Publication date (YYYY-MM-DD format) - <code>created_date</code>: Creation date - <code>updated_date</code>: Last modified date (auto-updated by editor) - <code>tags</code>: List of tags <code>[tag1, tag2, tag3]</code> - <code>description</code>: Brief summary (used in meta tags)</p>"},{"location":"content/writing/#date-handling","title":"Date Handling","text":"<p>Dates can be: - <code>YYYY-MM-DD</code> format: <code>2026-01-09</code> - <code>null</code>: No date set - Omitted: Field not used</p> <p>The <code>updated_date</code> is automatically set when saving through the web editor.</p>"},{"location":"content/writing/#advanced-markdown","title":"Advanced Markdown","text":""},{"location":"content/writing/#footnotes","title":"Footnotes","text":"<pre><code>Here's a sentence with a footnote.[^1]\n\n[^1]: This is the footnote content.\n</code></pre>"},{"location":"content/writing/#attribute-lists","title":"Attribute Lists","text":"<p>Add attributes to elements:</p> <pre><code>## Header {: #custom-id }\n\n[Link](url){: .external target=\"_blank\" }\n</code></pre>"},{"location":"content/writing/#tables-of-contents","title":"Tables of Contents","text":"<p>Add <code>[TOC]</code> on its own line to generate a table of contents:</p> <pre><code>---\ntitle: Long Article\n---\n\n[TOC]\n\n## Section 1\nContent here...\n\n## Section 2\nMore content...\n</code></pre>"},{"location":"content/writing/#include-files","title":"Include Files","text":"<p>Include external files in your content:</p> <pre><code>{{include: code-example.py}}\n</code></pre> <p>This is useful for: - Sharing code examples across multiple articles - Keeping large code blocks in separate files - Reusing common content sections</p> <p>Include files are resolved relative to the article's directory. See Page Directories for details.</p>"},{"location":"content/writing/#draft-vs-published","title":"Draft vs Published","text":"<p>Control visibility with the <code>status</code> field:</p> <p>Published: <pre><code>---\ntitle: My Article\nstatus: published\npublished_date: 2026-01-09\n---\n</code></pre></p> <p>Article appears in garden views and search results.</p> <p>Draft: <pre><code>---\ntitle: Work in Progress\nstatus: draft\npublished_date: null\n---\n</code></pre></p> <p>Article is hidden from public views but accessible to editors.</p>"},{"location":"content/writing/#seo-best-practices","title":"SEO Best Practices","text":""},{"location":"content/writing/#set-descriptions","title":"Set Descriptions","text":"<pre><code>---\ntitle: Python Tutorial\ndescription: Learn Python basics with hands-on examples\n---\n</code></pre>"},{"location":"content/writing/#use-descriptive-titles","title":"Use Descriptive Titles","text":"<p>Good: \"Getting Started with Python Virtual Environments\" Bad: \"Python Tutorial 1\"</p>"},{"location":"content/writing/#tag-appropriately","title":"Tag Appropriately","text":"<pre><code>tags: [python, tutorial, beginner, virtual-environments]\n</code></pre> <p>Use 3-6 relevant tags per article.</p>"},{"location":"content/writing/#link-internally","title":"Link Internally","text":"<p>Use wiki-links to create connections:</p> <pre><code>For more information, see [[Python Basics]] and [[Advanced Topics]].\n</code></pre>"},{"location":"content/writing/#file-organization","title":"File Organization","text":""},{"location":"content/writing/#flat-structure","title":"Flat Structure","text":"<p>Simple blogs can use flat files:</p> <pre><code>content/\n  blog/\n    article-1.md\n    article-2.md\n    article-3.md\n</code></pre>"},{"location":"content/writing/#hierarchical-structure","title":"Hierarchical Structure","text":"<p>Complex projects benefit from nested page directories:</p> <pre><code>content/\n  projects/\n    my-app.page/\n      page.md\n      screenshot.png\n      getting-started.page/\n        page.md\n      api.page/\n        page.md\n</code></pre> <p>See Page Directories for details.</p>"},{"location":"content/writing/#tips","title":"Tips","text":"<p>Keep filenames simple: - Use lowercase - Use hyphens for spaces - Avoid special characters - Be descriptive: <code>python-virtual-environments.md</code> not <code>pvenv.md</code></p> <p>Write regularly: - Draft posts can stay in <code>status: draft</code> until ready - Set future <code>published_date</code> for scheduled content (requires manual publishing)</p> <p>Use tags consistently: - Create a tag taxonomy - Reuse existing tags - Avoid tag proliferation</p> <p>Link generously: - Use wiki-links for internal references - Create connections between related articles - Build a knowledge graph</p>"},{"location":"content/writing/#next-steps","title":"Next Steps","text":"<ul> <li>Content Structure - Organize multiple gardens</li> <li>Wiki Links - Internal linking</li> <li>Page Directories - Hierarchical content</li> </ul>"},{"location":"getting-started/first-garden/","title":"Your First Garden","text":"<p>A step-by-step guide to creating a complete digital garden with multiple posts.</p>"},{"location":"getting-started/first-garden/#what-is-a-garden","title":"What is a Garden?","text":"<p>In Trellis, a \"garden\" is a collection of related content. Think of it like:</p> <ul> <li>A blog category (e.g., \"Tech Blog\", \"Personal Thoughts\")</li> <li>A topic area (e.g., \"Python Tutorials\", \"Book Reviews\")</li> <li>A project (e.g., \"My App Documentation\")</li> </ul> <p>You can have multiple gardens, each with its own theme and organization.</p>"},{"location":"getting-started/first-garden/#setting-up-your-data-directory","title":"Setting Up Your Data Directory","text":"<p>Choose where your content will live:</p> <pre><code># Create your data directory\nmkdir ~/my-trellis-site\ncd ~/my-trellis-site\n\n# Initialize the database\ntrellis-init-db\n</code></pre> <p>This creates: <pre><code>my-trellis-site/\n  trellis_admin.db         # User accounts\n  trellis_content.db       # Content metadata cache\n  content/                 # Your markdown files go here\n  search_index/            # Full-text search index\n</code></pre></p>"},{"location":"getting-started/first-garden/#optional-set-up-git","title":"Optional: Set Up Git","text":"<p>Track your content changes with version control:</p> <pre><code>git init\ngit add .\ngit commit -m \"Initial Trellis setup\"\n</code></pre> <p>Trellis will automatically commit changes when you save content through the web editor.</p>"},{"location":"getting-started/first-garden/#create-your-first-garden","title":"Create Your First Garden","text":"<p>Let's create a blog garden:</p> <pre><code>mkdir content/blog\n</code></pre> <p>Create <code>content/blog/config.yaml</code>:</p> <pre><code>title: My Blog\ndescription: Personal thoughts and technical writing\ncreated_date: 2026-01-09\norder: 1\n</code></pre> <p>Configuration options:</p> <ul> <li><code>title</code>: Display name for your garden</li> <li><code>description</code>: Brief description (shown in garden list)</li> <li><code>created_date</code>: When you created this garden</li> <li><code>order</code>: Sort order (lower numbers appear first)</li> </ul>"},{"location":"getting-started/first-garden/#write-multiple-posts","title":"Write Multiple Posts","text":""},{"location":"getting-started/first-garden/#post-1-welcome","title":"Post 1: Welcome","text":"<p>Create <code>content/blog/welcome.md</code>:</p> <pre><code>---\ntitle: Welcome to My Garden\npublished_date: 2026-01-09\ntags: [meta, welcome]\nstatus: published\n---\n\nThis is my digital garden where I share thoughts, projects, and learnings.\n\n## What I'll Write About\n\n- Technology and programming\n- Personal projects\n- Book reviews\n- Random musings\n\nStay tuned!\n</code></pre>"},{"location":"getting-started/first-garden/#post-2-a-technical-article","title":"Post 2: A Technical Article","text":"<p>Create <code>content/blog/python-tips.md</code>:</p> <pre><code>---\ntitle: 5 Python Tips for Beginners\npublished_date: 2026-01-09\ntags: [python, programming, tutorial]\nstatus: published\n---\n\nHere are five things I wish I knew when starting with Python.\n\n## 1. Use Virtual Environments\n\nAlways create a virtual environment for your projects:\n\n```python\npython3 -m venv venv\nsource venv/bin/activate\n</code></pre>"},{"location":"getting-started/first-garden/#2-f-strings-are-your-friend","title":"2. F-Strings Are Your Friend","text":"<p>Instead of: <pre><code>name = \"Alice\"\nprint(\"Hello, \" + name)\n</code></pre></p> <p>Use: <pre><code>name = \"Alice\"\nprint(f\"Hello, {name}\")\n</code></pre></p>"},{"location":"getting-started/first-garden/#3-list-comprehensions","title":"3. List Comprehensions","text":"<p>Transform lists elegantly: <pre><code>squares = [x**2 for x in range(10)]\n</code></pre></p>"},{"location":"getting-started/first-garden/#4-the-with-statement","title":"4. The <code>with</code> Statement","text":"<p>Always use <code>with</code> for file operations: <pre><code>with open('file.txt', 'r') as f:\n    content = f.read()\n</code></pre></p>"},{"location":"getting-started/first-garden/#5-use-enumerate-in-loops","title":"5. Use <code>enumerate()</code> in Loops","text":"<p>Instead of: <pre><code>for i in range(len(items)):\n    print(i, items[i])\n</code></pre></p> <p>Use: <pre><code>for i, item in enumerate(items):\n    print(i, item)\n</code></pre></p> <p>Check out [[Python Resources]] for more learning materials! <pre><code>### Post 3: Draft Post\n\nCreate `content/blog/draft-post.md`:\n\n```markdown\n---\ntitle: Work in Progress\npublished_date: null\ntags: [draft]\nstatus: draft\n---\n\nThis is a draft post. It won't appear in the public garden view because the status is \"draft\".\n\nUse this for work-in-progress content.\n</code></pre></p>"},{"location":"getting-started/first-garden/#frontmatter-fields","title":"Frontmatter Fields","text":"<p>Every post should have YAML frontmatter at the top:</p> <p>Required: - <code>title</code>: Post title - <code>status</code>: <code>published</code> or <code>draft</code></p> <p>Optional: - <code>published_date</code>: When you published it (YYYY-MM-DD) - <code>created_date</code>: When you wrote it - <code>updated_date</code>: Auto-updated when you save - <code>tags</code>: List of tags <code>[tag1, tag2]</code> - <code>description</code>: Brief summary (for SEO)</p>"},{"location":"getting-started/first-garden/#build-search-index","title":"Build Search Index","text":"<p>After creating content, build the search index:</p> <pre><code>trellis-search --rebuild\n</code></pre> <p>This enables full-text search across all your content.</p>"},{"location":"getting-started/first-garden/#run-your-site","title":"Run Your Site","text":"<p>Create a <code>run.py</code> file in your site directory:</p> <pre><code>from trellis import create_app\nimport os\n\n# Tell Trellis where your data is\nos.environ['DATA_DIR'] = os.path.dirname(os.path.abspath(__file__))\n\napp = create_app()\n\nif __name__ == '__main__':\n    app.run(debug=True, host='0.0.0.0', port=5000)\n</code></pre> <p>Run it:</p> <pre><code>python run.py\n</code></pre> <p>Visit <code>http://localhost:5000</code></p>"},{"location":"getting-started/first-garden/#using-the-web-editor","title":"Using the Web Editor","text":"<ol> <li>Login: Navigate to <code>/auth/login</code>, use <code>admin</code> / <code>admin</code></li> <li>Change password: Go to profile and update your password immediately</li> <li>Access editor: Click \"Editor\" in the navigation</li> <li>Edit posts: Browse your gardens and click \"Edit\" on any post</li> <li>Create new: Click \"New Article\" in the editor dashboard</li> </ol> <p>The web editor provides: - Syntax highlighting for markdown - Live preview - Auto-save to prevent data loss - Automatic git commits - Frontmatter editing</p>"},{"location":"getting-started/first-garden/#create-additional-gardens","title":"Create Additional Gardens","text":"<p>Want more than one garden? Just repeat the process:</p> <pre><code>mkdir content/projects\n</code></pre> <p><code>content/projects/config.yaml</code>:</p> <pre><code>title: My Projects\ndescription: Software projects and experiments\ncreated_date: 2026-01-09\norder: 2\n</code></pre> <p>Then add articles to <code>content/projects/</code>.</p>"},{"location":"getting-started/first-garden/#directory-structure","title":"Directory Structure","text":"<p>After following this guide, you should have:</p> <pre><code>my-trellis-site/\n  run.py\n  .env                       # Optional environment config\n  trellis_admin.db\n  trellis_content.db\n  content/\n    blog/\n      config.yaml\n      welcome.md\n      python-tips.md\n      draft-post.md\n    projects/\n      config.yaml\n  search_index/\n    # Search index files\n</code></pre>"},{"location":"getting-started/first-garden/#next-steps","title":"Next Steps","text":"<ul> <li>Writing Content - Advanced markdown features</li> <li>Wiki Links - Link between posts easily</li> <li>Page Directories - Hierarchical organization</li> <li>Backup Strategy - Protect your content</li> </ul>"},{"location":"getting-started/installation/","title":"Installation Guide","text":"<p>Detailed installation instructions for Trellis CMS.</p>"},{"location":"getting-started/installation/#system-requirements","title":"System Requirements","text":"<ul> <li>Python: 3.9 or higher</li> <li>Operating System: Linux, macOS, or Windows</li> <li>Disk Space: ~50MB for Trellis + dependencies</li> <li>RAM: Minimum 512MB (recommended 1GB+)</li> </ul>"},{"location":"getting-started/installation/#installing-python","title":"Installing Python","text":""},{"location":"getting-started/installation/#macos","title":"macOS","text":"<p>Python 3 is usually pre-installed. Check your version:</p> <pre><code>python3 --version\n</code></pre> <p>If you need to install or upgrade:</p> <pre><code># Using Homebrew\nbrew install python3\n</code></pre>"},{"location":"getting-started/installation/#linux-ubuntudebian","title":"Linux (Ubuntu/Debian)","text":"<pre><code>sudo apt update\nsudo apt install python3 python3-pip python3-venv\n</code></pre>"},{"location":"getting-started/installation/#windows","title":"Windows","text":"<p>Download Python from python.org and run the installer. Make sure to check \"Add Python to PATH\" during installation.</p>"},{"location":"getting-started/installation/#installing-trellis","title":"Installing Trellis","text":""},{"location":"getting-started/installation/#option-1-install-from-pypi-recommended","title":"Option 1: Install from PyPI (Recommended)","text":"<p>Temporary Additional Steps Required</p> <p>Until qdflask and qdcomments are published to PyPI, install them from GitHub first:</p> <pre><code># Install dependencies from GitHub\npip install git+https://github.com/almargolis/quickdev.git#subdirectory=qdflask\npip install git+https://github.com/almargolis/quickdev.git#subdirectory=qdcomments\n\n# Install Trellis\npip install trellis-cms\n</code></pre> <p>Future Installation (Once Dependencies Are on PyPI)</p> <p>This will eventually be simplified to just: <pre><code>pip install trellis-cms\n</code></pre></p>"},{"location":"getting-started/installation/#option-2-install-from-source","title":"Option 2: Install from Source","text":"<p>For the latest development version:</p> <pre><code>git clone https://github.com/almargolis/trellis.git\ncd trellis\n\n# Install dependencies from GitHub\npip install git+https://github.com/almargolis/quickdev.git#subdirectory=qdflask\npip install git+https://github.com/almargolis/quickdev.git#subdirectory=qdcomments\n\n# Install Trellis\npip install -e .\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<p>Check that Trellis commands are available:</p> <pre><code>trellis-init-db --help\ntrellis-search --help\n</code></pre> <p>You should see help text for each command.</p>"},{"location":"getting-started/installation/#using-virtual-environments-recommended","title":"Using Virtual Environments (Recommended)","text":"<p>Virtual environments keep Trellis isolated from other Python projects:</p> <pre><code># Create a virtual environment\npython3 -m venv trellis-env\n\n# Activate it\nsource trellis-env/bin/activate  # Linux/macOS\n# or\ntrellis-env\\Scripts\\activate  # Windows\n\n# Install Trellis\npip install trellis-cms\n</code></pre> <p>To deactivate:</p> <pre><code>deactivate\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<p>Continue to Quick Start to set up your first site, or jump to First Garden for a detailed walkthrough.</p>"},{"location":"getting-started/installation/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/installation/#pip-command-not-found","title":"\"pip: command not found\"","text":"<p>On some systems, use <code>pip3</code> instead of <code>pip</code>:</p> <pre><code>pip3 install trellis-cms\n</code></pre>"},{"location":"getting-started/installation/#permission-denied","title":"\"Permission denied\"","text":"<p>Use <code>--user</code> flag to install for your user only:</p> <pre><code>pip install --user trellis-cms\n</code></pre> <p>Or use a virtual environment (recommended).</p>"},{"location":"getting-started/installation/#modulenotfounderror","title":"\"ModuleNotFoundError\"","text":"<p>If Python can't find trellis after installation:</p> <ol> <li>Check which Python you're using: <code>which python3</code></li> <li>Check where pip installed packages: <code>pip show trellis-cms</code></li> <li>Make sure they match (same Python version)</li> </ol>"},{"location":"getting-started/installation/#behind-a-proxy","title":"Behind a Proxy","text":"<p>Set environment variables:</p> <pre><code>export HTTP_PROXY=http://proxy:port\nexport HTTPS_PROXY=https://proxy:port\npip install trellis-cms\n</code></pre>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>Get your digital garden running in under 5 minutes.</p>"},{"location":"getting-started/quickstart/#prerequisites-devops","title":"Prerequisites - DevOps","text":"<p>There are a number of operational things that must be handled before your application can run. There are a lot of ways to do take care of those prerequisites and this application can adapt to almost anything approach you want to take.</p> <p>This application is built using QuickDev. QuickDev includes tools for quickly handling most DevOps needs in a consistent, documented way. See the QuickDev DevOps Guide to learn what needs to be done and what tools QuickDev provides to help.</p> <p>Things that need to be handled:</p> <ul> <li>Configure Server<ul> <li>QuickDev mainly supports Linux and MacOS</li> <li>Install / Configure webserver<ul> <li>QuickDev mainly supports Apache configuration but runs fine under any server.</li> <li>Configure virtual hosts if your server supports multiple sites</li> </ul> </li> </ul> </li> <li>DNS Domain<ul> <li>create domain</li> <li>create host records</li> </ul> </li> </ul>"},{"location":"getting-started/quickstart/#prerequisites-your-trellis-app","title":"Prerequisites - Your Trellis App","text":"<ul> <li>Python 3.9 or higher</li> <li>pip (Python package installer)</li> </ul> <p>First Time?</p> <p>If you've never used Python before, see the detailed installation guide.</p>"},{"location":"getting-started/quickstart/#installation","title":"Installation","text":""},{"location":"getting-started/quickstart/#create-virtual-environment-recommended","title":"Create Virtual Environment (Recommended)","text":"<pre><code># Create virtual environment\npython3 -m venv trellis-env\n\n# Activate it\nsource trellis-env/bin/activate  # Linux/macOS\n# OR\ntrellis-env\\Scripts\\activate     # Windows\n</code></pre>"},{"location":"getting-started/quickstart/#install-trellis","title":"Install Trellis","text":"<p>Temporary Installation Steps</p> <p>Until qdflask and qdcomments are published to PyPI, you need to install them from GitHub first:</p> <pre><code># Install dependencies from GitHub\npip install git+https://github.com/almargolis/quickdev.git#subdirectory=qdflask\npip install git+https://github.com/almargolis/quickdev.git#subdirectory=qdcomments\n\n# Install Trellis\npip install trellis-cms\n</code></pre> <p>Future Simplified Installation</p> <p>Once dependencies are on PyPI, this will simply be: <pre><code>pip install trellis-cms\n</code></pre></p>"},{"location":"getting-started/quickstart/#initialize-your-site","title":"Initialize Your Site","text":"<p>Create a new directory for your site and initialize the database:</p> <pre><code># Create a data directory\nmkdir my-garden\ncd my-garden\n\n# Initialize the database\ntrellis-init-db\n</code></pre> <p>This creates: - <code>trellis_admin.db</code> - User accounts and settings - <code>content/</code> - Directory for your markdown files</p> <p>Default login: <code>admin</code> / <code>admin</code> (change this immediately!)</p>"},{"location":"getting-started/quickstart/#create-your-first-garden","title":"Create Your First Garden","text":"<p>A \"garden\" is a collection of related articles (like a blog category). Create one:</p> <pre><code>mkdir -p content/blog\n</code></pre> <p>Create a garden configuration file <code>content/blog/config.yaml</code>:</p> <pre><code>title: My Blog\ndescription: Thoughts and musings\ncreated_date: null\norder: 1\n</code></pre>"},{"location":"getting-started/quickstart/#write-your-first-post","title":"Write Your First Post","text":"<p>Create <code>content/blog/hello-world.md</code>:</p> <pre><code>---\ntitle: Hello World\npublished_date: 2026-01-09\ntags: [welcome, intro]\nstatus: published\n---\n\nWelcome to my digital garden! This is my first post.\n\nI can write in **markdown** with all the usual formatting:\n\n- Lists\n- **Bold** and *italic*\n- [Links](https://example.com)\n- Code blocks\n\n```python\ndef hello():\n    print(\"Hello from Trellis!\")\n</code></pre> <p>And I can link to other pages using wiki-style links: [[Another Page]] <pre><code>## Initialize Search\n\nBuild the search index so your content is discoverable:\n\n```bash\ntrellis-search --rebuild\n</code></pre></p>"},{"location":"getting-started/quickstart/#run-your-site","title":"Run Your Site","text":"<p>Start the development server:</p> <pre><code>python -m flask --app trellis run\n</code></pre> <p>Or create a simple <code>run.py</code> file:</p> <pre><code>from trellis import create_app\n\napp = create_app()\n\nif __name__ == '__main__':\n    app.run(debug=True, host='0.0.0.0', port=5000)\n</code></pre> <p>Then run:</p> <pre><code>python run.py\n</code></pre> <p>Visit <code>http://localhost:5000</code> in your browser!</p>"},{"location":"getting-started/quickstart/#first-steps","title":"First Steps","text":"<ol> <li>Login: Click \"Login\" and use <code>admin</code> / <code>admin</code></li> <li>Change Password: Go to your profile and change the default password</li> <li>Create Content: Click \"Editor\" to access the web-based editor</li> <li>Customize: Edit <code>content/blog/config.yaml</code> to change your garden's title</li> </ol>"},{"location":"getting-started/quickstart/#whats-next","title":"What's Next?","text":"<ul> <li>Writing Content - Learn markdown and frontmatter</li> <li>Content Structure - Organize multiple gardens</li> <li>Backup Strategy - Protect your content</li> </ul>"},{"location":"getting-started/quickstart/#environment-variables","title":"Environment Variables","text":"<p>For production deployment, create a <code>.env</code> file:</p> <pre><code>SECRET_KEY=your-secret-key-here\nSITE_NAME=My Digital Garden\nSITE_AUTHOR=Your Name\nDATA_DIR=/path/to/data\n</code></pre> <p>See Deployment for production setup details.</p>"},{"location":"getting-started/quickstart/#troubleshooting","title":"Troubleshooting","text":"<p>Port already in use?</p> <pre><code>python -m flask --app trellis run --port 5001\n</code></pre> <p>Can't find trellis module?</p> <p>Make sure you installed it: <code>pip install trellis-cms</code></p> <p>Search not working?</p> <p>Rebuild the search index: <code>trellis-search --rebuild</code></p>"},{"location":"includes/backup-git-setup/","title":"Backup git setup","text":""},{"location":"includes/backup-git-setup/#initialize-git-repository","title":"Initialize Git Repository","text":"<pre><code>cd /path/to/your/site\ngit init\n</code></pre>"},{"location":"includes/backup-git-setup/#create-gitignore","title":"Create <code>.gitignore</code>","text":"<p>Exclude binary content and generated files:</p> <pre><code># Databases (backed up by rsync)\n*.db\n*.db-journal\n*.db-wal\n\n# Search index (can be rebuilt)\nsearch_index/\n\n# Large binary files (backed up by rsync)\n*.png\n*.jpg\n*.jpeg\n*.gif\n*.bmp\n*.ico\n*.pdf\n*.zip\n*.tar.gz\n*.mp4\n*.mov\n*.avi\n\n# System files\n.DS_Store\nThumbs.db\n__pycache__/\n*.pyc\n\n# Environment files (may contain secrets)\n.env\n\n# Keep text content in git\n!*.md\n!*.yaml\n!*.yml\n!*.py\n!*.js\n!*.css\n!*.html\n!*.txt\n</code></pre>"},{"location":"includes/backup-git-setup/#initial-commit","title":"Initial Commit","text":"<pre><code>git add .\ngit commit -m \"Initial site setup\"\n</code></pre>"},{"location":"includes/backup-git-setup/#optional-push-to-remote","title":"Optional: Push to Remote","text":"<pre><code># Create a repository on GitHub/GitLab, then:\ngit remote add origin git@github.com:yourusername/your-site.git\ngit branch -M main\ngit push -u origin main\n</code></pre>"},{"location":"includes/quickdev-dev-setup/","title":"Quickdev dev setup","text":""},{"location":"includes/quickdev-dev-setup/#working-with-quickdev-dependencies","title":"Working with Quickdev Dependencies","text":"<p>If you're developing features that span both the application and quickdev packages (qdflask, qdcomments, etc.), use editable installations:</p> <pre><code># Clone quickdev repository\ngit clone https://github.com/almargolis/quickdev.git\n\n# In your application virtual environment\nsource venv/bin/activate\n\n# Install quickdev packages in editable mode\npip install -e ../quickdev/qdflask\npip install -e ../quickdev/qdcomments\n\n# Changes to quickdev packages take effect immediately\n</code></pre> <p>Directory structure: <pre><code>Projects/\n  your-app/\n    venv/\n    your-app/\n  quickdev/\n    qdflask/\n    qdcomments/\n</code></pre></p> <p>Benefits: - Changes in quickdev packages take effect immediately (no reinstall needed) - Easy to test changes across application and dependencies - Git workflow works in both repos independently</p> <p>Switching back to PyPI versions: <pre><code>pip uninstall qdflask qdcomments\npip install qdflask qdcomments\n</code></pre></p>"},{"location":"maintenance/backup/","title":"Backup Strategy","text":"<p>Protect your Trellis content with a robust backup approach.</p>"},{"location":"maintenance/backup/#what-needs-backing-up","title":"What Needs Backing Up?","text":"<p>Your Trellis site contains:</p> <p>Text Content (version control recommended): - Markdown files (<code>*.md</code>) - Configuration files (<code>config.yaml</code>) - Include files (Python, YAML, text)</p> <p>Binary Content (file-based backups): - Images (PNG, JPG, GIF) - PDFs and documents - Videos and other media</p> <p>Databases (file-based backups): - <code>trellis_admin.db</code> - User accounts - <code>trellis_content.db</code> - Content metadata cache</p> <p>Generated Content (can be rebuilt): - <code>search_index/</code> - Full-text search index</p>"},{"location":"maintenance/backup/#recommended-approach-hybrid-strategy","title":"Recommended Approach: Hybrid Strategy","text":"<p>Use Git for text content and rsync for full backups.</p>"},{"location":"maintenance/backup/#why-this-approach","title":"Why This Approach?","text":"<p>Git Benefits: - \u2705 Version history for text - \u2705 Easy rollback - \u2705 Works great with markdown - \u2705 Can push to remote (GitHub, GitLab) - \u274c Poor performance with binary files - \u274c Bloats repository with large files</p> <p>Rsync Benefits: - \u2705 Efficient binary file backups - \u2705 Incremental backups (only changed files) - \u2705 Fast and reliable - \u2705 Handles databases and images well - \u274c No version history - \u274c Requires separate backup location</p> <p>Hybrid = Best of Both Worlds</p>"},{"location":"maintenance/backup/#setup-git-for-text-content","title":"Setup: Git for Text Content","text":""},{"location":"maintenance/backup/#initialize-git-repository","title":"Initialize Git Repository","text":"<pre><code>cd /path/to/your/site\ngit init\n</code></pre>"},{"location":"maintenance/backup/#create-gitignore","title":"Create <code>.gitignore</code>","text":"<p>Exclude binary content and generated files:</p> <pre><code># Databases (backed up by rsync)\n*.db\n*.db-journal\n*.db-wal\n\n# Search index (can be rebuilt)\nsearch_index/\n\n# Large binary files (backed up by rsync)\n*.png\n*.jpg\n*.jpeg\n*.gif\n*.bmp\n*.ico\n*.pdf\n*.zip\n*.tar.gz\n*.mp4\n*.mov\n*.avi\n\n# System files\n.DS_Store\nThumbs.db\n__pycache__/\n*.pyc\n\n# Environment files (may contain secrets)\n.env\n\n# Keep text content in git\n!*.md\n!*.yaml\n!*.yml\n!*.py\n!*.js\n!*.css\n!*.html\n!*.txt\n</code></pre>"},{"location":"maintenance/backup/#initial-commit","title":"Initial Commit","text":"<pre><code>git add .\ngit commit -m \"Initial site setup\"\n</code></pre>"},{"location":"maintenance/backup/#optional-push-to-remote","title":"Optional: Push to Remote","text":"<pre><code># Create a repository on GitHub/GitLab, then:\ngit remote add origin git@github.com:yourusername/your-site.git\ngit branch -M main\ngit push -u origin main\n</code></pre>"},{"location":"maintenance/backup/#auto-commit-setup","title":"Auto-Commit Setup","text":"<p>Trellis automatically commits changes when you save content through the web editor if <code>GITLAB_REPO_PATH</code> is set:</p> <p>In your <code>.env</code>: <pre><code>GITLAB_REPO_PATH=/path/to/your/site\n</code></pre></p> <p>Each save creates a commit like: <pre><code>Update: content/blog/article.md\n</code></pre></p>"},{"location":"maintenance/backup/#manual-commits","title":"Manual Commits","text":"<p>For bulk changes:</p> <pre><code>git add content/\ngit commit -m \"Added new article series\"\ngit push origin main\n</code></pre>"},{"location":"maintenance/backup/#setup-rsync-for-full-backups","title":"Setup: Rsync for Full Backups","text":""},{"location":"maintenance/backup/#basic-rsync-backup","title":"Basic Rsync Backup","text":"<pre><code>#!/bin/bash\n# backup.sh\n\nSOURCE=\"/path/to/your/site\"\nBACKUP=\"/backup/trellis-$(date +%Y%m%d-%H%M%S)\"\n\nrsync -av --delete \"$SOURCE/\" \"$BACKUP/\"\n\necho \"Backup complete: $BACKUP\"\n</code></pre> <p>Make it executable: <pre><code>chmod +x backup.sh\n</code></pre></p> <p>Run it: <pre><code>./backup.sh\n</code></pre></p>"},{"location":"maintenance/backup/#advanced-backup-script","title":"Advanced Backup Script","text":"<p>Create <code>backup-trellis.sh</code>:</p> <pre><code>#!/bin/bash\n# Comprehensive Trellis backup script\n\nset -e  # Exit on error\n\n# Configuration\nSITE_DIR=\"/var/www/trellis_data\"\nBACKUP_BASE=\"/backup/trellis\"\nKEEP_DAYS=30\nTIMESTAMP=$(date +%Y%m%d-%H%M%S)\nBACKUP_DIR=\"$BACKUP_BASE/$TIMESTAMP\"\n\n# Create backup directory\nmkdir -p \"$BACKUP_DIR\"\n\necho \"Starting Trellis backup...\"\necho \"Source: $SITE_DIR\"\necho \"Destination: $BACKUP_DIR\"\n\n# Full rsync backup\nrsync -av \\\n  --delete \\\n  --exclude='.git/' \\\n  --exclude='__pycache__/' \\\n  --exclude='*.pyc' \\\n  \"$SITE_DIR/\" \\\n  \"$BACKUP_DIR/\"\n\n# Verify critical files\nCRITICAL_FILES=(\n  \"trellis_admin.db\"\n  \"trellis_content.db\"\n  \"content\"\n)\n\nfor file in \"${CRITICAL_FILES[@]}\"; do\n  if [ ! -e \"$BACKUP_DIR/$file\" ]; then\n    echo \"ERROR: Critical file missing: $file\"\n    exit 1\n  fi\ndone\n\n# Create backup manifest\ncat &gt; \"$BACKUP_DIR/backup-info.txt\" &lt;&lt;EOF\nBackup Date: $(date)\nSource: $SITE_DIR\nBackup Script: $0\nHostname: $(hostname)\nEOF\n\n# Compress backup (optional)\n# tar -czf \"$BACKUP_BASE/trellis-$TIMESTAMP.tar.gz\" -C \"$BACKUP_BASE\" \"$TIMESTAMP\"\n# rm -rf \"$BACKUP_DIR\"\n\n# Clean old backups\necho \"Removing backups older than $KEEP_DAYS days...\"\nfind \"$BACKUP_BASE\" -maxdepth 1 -type d -mtime +$KEEP_DAYS -exec rm -rf {} \\;\n\necho \"Backup complete: $BACKUP_DIR\"\n\n# Optional: Git commit and push\nif [ -d \"$SITE_DIR/.git\" ]; then\n  echo \"Committing text changes to git...\"\n  cd \"$SITE_DIR\"\n  git add -A\n  if git diff --staged --quiet; then\n    echo \"No changes to commit\"\n  else\n    git commit -m \"Automated backup: $(date)\"\n    git push origin main || echo \"Warning: Could not push to remote\"\n  fi\nfi\n\necho \"All backup tasks complete\"\n</code></pre> <p>Make it executable: <pre><code>chmod +x backup-trellis.sh\n</code></pre></p>"},{"location":"maintenance/backup/#schedule-automatic-backups","title":"Schedule Automatic Backups","text":"<p>Use cron to run backups automatically:</p> <pre><code>crontab -e\n</code></pre> <p>Add one of these schedules:</p> <pre><code># Daily backup at 2 AM\n0 2 * * * /path/to/backup-trellis.sh &gt;&gt; /var/log/trellis-backup.log 2&gt;&amp;1\n\n# Every 6 hours\n0 */6 * * * /path/to/backup-trellis.sh &gt;&gt; /var/log/trellis-backup.log 2&gt;&amp;1\n\n# Weekly on Sunday at 3 AM\n0 3 * * 0 /path/to/backup-trellis.sh &gt;&gt; /var/log/trellis-backup.log 2&gt;&amp;1\n</code></pre>"},{"location":"maintenance/backup/#remote-backups-with-rsync","title":"Remote Backups with Rsync","text":"<p>Backup to remote server:</p> <pre><code>#!/bin/bash\n# remote-backup.sh\n\nSITE_DIR=\"/path/to/your/site\"\nREMOTE_USER=\"backup\"\nREMOTE_HOST=\"backup.example.com\"\nREMOTE_DIR=\"/backups/trellis\"\n\nrsync -av \\\n  --delete \\\n  -e \"ssh -i ~/.ssh/backup_key\" \\\n  \"$SITE_DIR/\" \\\n  \"$REMOTE_USER@$REMOTE_HOST:$REMOTE_DIR/\"\n\necho \"Remote backup complete\"\n</code></pre>"},{"location":"maintenance/backup/#cloud-backups","title":"Cloud Backups","text":""},{"location":"maintenance/backup/#amazon-s3","title":"Amazon S3","text":"<pre><code># Install AWS CLI\npip install awscli\n\n# Configure credentials\naws configure\n\n# Sync to S3\naws s3 sync /path/to/your/site s3://your-bucket/trellis-backup/ \\\n  --exclude \".git/*\" \\\n  --exclude \"__pycache__/*\" \\\n  --exclude \"search_index/*\"\n</code></pre>"},{"location":"maintenance/backup/#backblaze-b2","title":"Backblaze B2","text":"<pre><code># Install B2 CLI\npip install b2\n\n# Authenticate\nb2 authorize-account\n\n# Sync to B2\nb2 sync /path/to/your/site b2://your-bucket/trellis-backup \\\n  --excludeRegex \"\\.git|__pycache__|search_index\"\n</code></pre>"},{"location":"maintenance/backup/#rsyncnet","title":"Rsync.net","text":"<pre><code># Rsync.net provides rsync-over-ssh\nrsync -av --delete \\\n  -e \"ssh -p 22\" \\\n  /path/to/your/site/ \\\n  username@usw-s001.rsync.net:trellis-backup/\n</code></pre>"},{"location":"maintenance/backup/#restoration","title":"Restoration","text":""},{"location":"maintenance/backup/#restore-from-rsync-backup","title":"Restore from Rsync Backup","text":"<p>Full restoration:</p> <pre><code>BACKUP=\"/backup/trellis/20260109-020000\"\nSITE_DIR=\"/var/www/trellis_data\"\n\n# Stop the application\nsudo systemctl stop trellis\n\n# Restore files\nrsync -av \"$BACKUP/\" \"$SITE_DIR/\"\n\n# Set permissions\nsudo chown -R www-data:www-data \"$SITE_DIR\"\n\n# Rebuild search index\ncd \"$SITE_DIR\"\ntrellis-search --rebuild\ntrellis-index --clear\n\n# Start the application\nsudo systemctl start trellis\n</code></pre>"},{"location":"maintenance/backup/#restore-from-git","title":"Restore from Git","text":"<p>Rollback to previous version:</p> <pre><code>cd /path/to/your/site\n\n# View commit history\ngit log\n\n# Rollback to specific commit\ngit checkout abc123 -- content/\n\n# Or reset to previous state\ngit reset --hard HEAD~1\n\n# Rebuild indexes\ntrellis-search --rebuild\n</code></pre>"},{"location":"maintenance/backup/#restore-specific-files","title":"Restore Specific Files","text":"<pre><code># From rsync backup\ncp /backup/trellis/20260109/content/blog/article.md \\\n   /path/to/your/site/content/blog/\n\n# From git\ngit checkout HEAD~5 -- content/blog/article.md\n</code></pre>"},{"location":"maintenance/backup/#testing-your-backups","title":"Testing Your Backups","text":"<p>Monthly test restoration:</p> <pre><code># Create test environment\nmkdir /tmp/trellis-test\ncd /tmp/trellis-test\n\n# Restore from backup\nrsync -av /backup/trellis/latest/ .\n\n# Verify critical files\nls -lh trellis_admin.db trellis_content.db\nfind content -name \"*.md\" | head\n\n# Test database integrity\nsqlite3 trellis_admin.db \"PRAGMA integrity_check;\"\nsqlite3 trellis_content.db \"PRAGMA integrity_check;\"\n\n# Cleanup\nrm -rf /tmp/trellis-test\n</code></pre>"},{"location":"maintenance/backup/#backup-verification","title":"Backup Verification","text":"<p>Create <code>verify-backup.sh</code>:</p> <pre><code>#!/bin/bash\n\nBACKUP_DIR=\"$1\"\n\nif [ ! -d \"$BACKUP_DIR\" ]; then\n  echo \"Usage: $0 /path/to/backup\"\n  exit 1\nfi\n\necho \"Verifying backup: $BACKUP_DIR\"\n\n# Check critical files exist\nCRITICAL=(\n  \"trellis_admin.db\"\n  \"trellis_content.db\"\n  \"content\"\n)\n\nfor item in \"${CRITICAL[@]}\"; do\n  if [ -e \"$BACKUP_DIR/$item\" ]; then\n    echo \"\u2713 $item\"\n  else\n    echo \"\u2717 MISSING: $item\"\n    exit 1\n  fi\ndone\n\n# Check database integrity\necho \"Checking database integrity...\"\nsqlite3 \"$BACKUP_DIR/trellis_admin.db\" \"PRAGMA integrity_check;\" &gt; /dev/null\necho \"\u2713 trellis_admin.db is valid\"\n\nsqlite3 \"$BACKUP_DIR/trellis_content.db\" \"PRAGMA integrity_check;\" &gt; /dev/null\necho \"\u2713 trellis_content.db is valid\"\n\n# Count markdown files\nMD_COUNT=$(find \"$BACKUP_DIR/content\" -name \"*.md\" 2&gt;/dev/null | wc -l)\necho \"\u2713 Found $MD_COUNT markdown files\"\n\necho \"Backup verification complete\"\n</code></pre>"},{"location":"maintenance/backup/#best-practices","title":"Best Practices","text":"<p>Backup frequency: - Text content: Automatic via git (on every save) - Full backups: Daily or multiple times per day - Off-site backups: Weekly to monthly</p> <p>Retention: - Local backups: Keep 30 days - Remote backups: Keep 90+ days - Git history: Keep forever (text is small)</p> <p>3-2-1 Rule: - 3 copies of your data - 2 different storage types - 1 off-site backup</p> <p>Example implementation: 1. Primary: Your live site 2. Local: Rsync to local NAS/external drive 3. Remote: Git push to GitHub + S3/B2 sync</p> <p>Test regularly: - Monthly restoration tests - Verify database integrity - Check file counts</p> <p>Monitor backups: - Log backup results - Alert on failures - Track backup sizes</p> <p>Security: - Encrypt off-site backups - Protect <code>.env</code> files with secrets - Use SSH keys for remote backups - Restrict backup script permissions (600)</p>"},{"location":"maintenance/backup/#troubleshooting","title":"Troubleshooting","text":"<p>Rsync permission denied: <pre><code># Use sudo for system directories\nsudo rsync -av ...\n\n# Or fix ownership\nsudo chown -R $USER /path/to/your/site\n</code></pre></p> <p>Git repository too large: <pre><code># Remove binary files from history\ngit filter-branch --tree-filter 'rm -f *.png *.jpg' HEAD\n\n# Or use BFG Repo-Cleaner\nbfg --delete-files *.png\n</code></pre></p> <p>Database locked during backup: <pre><code># Use SQLite backup API instead\nsqlite3 source.db \".backup backup.db\"\n</code></pre></p> <p>Out of disk space: <pre><code># Compress old backups\nfind /backup/trellis -type d -mtime +7 -exec tar -czf {}.tar.gz {} \\; -exec rm -rf {} \\;\n\n# Or reduce retention period\n</code></pre></p>"},{"location":"maintenance/backup/#next-steps","title":"Next Steps","text":"<ul> <li>Search Indexing - Manage search indexes</li> <li>Updates - Keeping Trellis up to date</li> <li>Deployment - Production setup</li> </ul>"},{"location":"maintenance/indexing/","title":"Search Indexing","text":"<p>Managing Trellis search and content indexes.</p>"},{"location":"maintenance/indexing/#overview","title":"Overview","text":"<p>Trellis maintains two indexes:</p> <ol> <li>Search Index (Whoosh) - Full-text search across all content</li> <li>Content Index (SQLite) - Metadata cache for wiki-links and queries</li> </ol> <p>Both indexes must stay synchronized with your content.</p>"},{"location":"maintenance/indexing/#index-update-modes","title":"Index Update Modes","text":""},{"location":"maintenance/indexing/#immediate-mode-default","title":"Immediate Mode (Default)","text":"<p>Indexes update automatically when you save/create content via the web editor:</p> <ul> <li>Single-file updates are fast (milliseconds)</li> <li>No manual intervention needed</li> <li>Best for single-user sites or low-traffic sites</li> </ul> <p>No configuration needed - this is the default behavior.</p>"},{"location":"maintenance/indexing/#deferred-mode","title":"Deferred Mode","text":"<p>Updates are queued and processed in batches:</p> <ul> <li>Better for high-traffic sites with multiple editors</li> <li>Reduces lock contention</li> <li>Requires periodic rebuilds via cron</li> </ul> <p>Setup:</p> <p>In your <code>.env</code>: <pre><code>TRELLIS_DEFERRED_INDEXING=true\n</code></pre></p> <p>Add cron job: <pre><code># Rebuild indexes every 5 minutes\n*/5 * * * * cd /var/www/trellis &amp;&amp; trellis-index-update\n</code></pre></p>"},{"location":"maintenance/indexing/#command-reference","title":"Command Reference","text":""},{"location":"maintenance/indexing/#update-all-indexes","title":"Update All Indexes","text":"<p>Check if rebuild is needed and rebuild if dirty:</p> <pre><code>trellis-index-update\n</code></pre> <p>Force rebuild regardless of dirty flag:</p> <pre><code>trellis-index-update --force\n</code></pre>"},{"location":"maintenance/indexing/#search-index-only","title":"Search Index Only","text":"<p>Rebuild full-text search index:</p> <pre><code>trellis-search --rebuild\n</code></pre> <p>Show search index statistics:</p> <pre><code>trellis-search --stats\n</code></pre> <p>Output: <pre><code>Search Index Statistics\n=======================\nTotal documents: 42\nIndex size: 1.2 MB\nLast updated: 2026-01-09 14:30:00\n</code></pre></p>"},{"location":"maintenance/indexing/#content-index-only","title":"Content Index Only","text":"<p>Rebuild content metadata cache:</p> <pre><code>trellis-index --clear\n</code></pre> <p>Show content index statistics:</p> <pre><code>trellis-index --stats\n</code></pre> <p>Output: <pre><code>Content Index Statistics\n========================\nTotal articles: 42\nGardens: 3\nTags: 15\nLast updated: 2026-01-09 14:30:00\n</code></pre></p>"},{"location":"maintenance/indexing/#when-to-rebuild","title":"When to Rebuild","text":""},{"location":"maintenance/indexing/#after-bulk-changes","title":"After Bulk Changes","text":"<pre><code># Added many articles manually\ncd content/blog\n# ... added 10 new .md files ...\n\n# Rebuild indexes\ntrellis-search --rebuild\n</code></pre>"},{"location":"maintenance/indexing/#after-restoring-from-backup","title":"After Restoring from Backup","text":"<pre><code># Restored files from backup\nrsync -av /backup/trellis/latest/ /var/www/trellis_data/\n\n# Rebuild all indexes\ntrellis-search --rebuild\ntrellis-index --clear\n</code></pre>"},{"location":"maintenance/indexing/#after-content-migration","title":"After Content Migration","text":"<pre><code># Moved articles between gardens\nmv content/old-garden/*.md content/new-garden/\n\n# Rebuild indexes\ntrellis-index-update --force\n</code></pre>"},{"location":"maintenance/indexing/#search-not-working","title":"Search Not Working","text":"<pre><code># Wiki-links or search returning nothing\ntrellis-search --rebuild\n</code></pre>"},{"location":"maintenance/indexing/#how-it-works","title":"How It Works","text":""},{"location":"maintenance/indexing/#immediate-mode-flow","title":"Immediate Mode Flow","text":"<ol> <li>User saves article via web editor</li> <li><code>MarkdownHandler.save_file()</code> writes markdown</li> <li><code>IndexManager.update_single_file()</code> updates indexes</li> <li>Search and wiki-links work immediately</li> </ol>"},{"location":"maintenance/indexing/#deferred-mode-flow","title":"Deferred Mode Flow","text":"<ol> <li>User saves article via web editor</li> <li><code>MarkdownHandler.save_file()</code> writes markdown</li> <li><code>IndexManager</code> sets <code>.index_dirty</code> flag file</li> <li>Cron job checks for flag, rebuilds if present</li> <li>Flag is cleared after successful rebuild</li> </ol>"},{"location":"maintenance/indexing/#index-structure","title":"Index Structure","text":"<p>Search Index (<code>search_index/</code>): <pre><code>search_index/\n  _MAIN_xxx.toc\n  _MAIN_xxx.seg\n  ...\n</code></pre></p> <p>Whoosh index files for full-text search.</p> <p>Content Index (<code>trellis_content.db</code>): <pre><code>CREATE TABLE articles (\n  id INTEGER PRIMARY KEY,\n  title TEXT,\n  slug TEXT,\n  garden_slug TEXT,\n  content TEXT,\n  tags TEXT,\n  published_date TEXT,\n  ...\n);\n</code></pre></p> <p>SQLite database for fast metadata lookups.</p>"},{"location":"maintenance/indexing/#performance-considerations","title":"Performance Considerations","text":""},{"location":"maintenance/indexing/#index-rebuild-times","title":"Index Rebuild Times","text":"<p>Typical rebuild times (depends on content size):</p> Articles Search Index Content Index Total 10 &lt; 1s &lt; 1s &lt; 2s 100 2-3s 1-2s 3-5s 1000 15-20s 5-10s 20-30s 10000 2-3 min 30-60s 3-4 min"},{"location":"maintenance/indexing/#single-file-updates","title":"Single File Updates","text":"<p>Immediate mode single-file updates:</p> Operation Time Update existing article 50-100ms Add new article 100-200ms Delete article 50-100ms <p>Much faster than full rebuild!</p>"},{"location":"maintenance/indexing/#optimization-tips","title":"Optimization Tips","text":"<p>For small sites (&lt; 100 articles): - Use immediate mode - No cron needed - Fast enough for real-time updates</p> <p>For medium sites (100-1000 articles): - Immediate mode still fine - Consider deferred for multiple concurrent editors - Cron every 5-10 minutes</p> <p>For large sites (&gt; 1000 articles): - Use deferred mode - Cron every 1-5 minutes - Consider dedicated search service (future feature)</p>"},{"location":"maintenance/indexing/#monitoring","title":"Monitoring","text":""},{"location":"maintenance/indexing/#check-index-health","title":"Check Index Health","text":"<pre><code># Verify search index\ntrellis-search --stats\n\n# Verify content index\ntrellis-index --stats\n\n# Check for dirty flag\nls -la /path/to/site/.index_dirty\n</code></pre>"},{"location":"maintenance/indexing/#log-index-operations","title":"Log Index Operations","text":"<p>Add logging to your cron job:</p> <pre><code>#!/bin/bash\n# index-update-cron.sh\n\nLOGFILE=\"/var/log/trellis-index.log\"\n\necho \"=== Index update started at $(date) ===\" &gt;&gt; \"$LOGFILE\"\ntrellis-index-update &gt;&gt; \"$LOGFILE\" 2&gt;&amp;1\nEXIT_CODE=$?\necho \"Exit code: $EXIT_CODE\" &gt;&gt; \"$LOGFILE\"\necho \"\" &gt;&gt; \"$LOGFILE\"\n\nif [ $EXIT_CODE -ne 0 ]; then\n  # Send alert (example)\n  echo \"Index update failed\" | mail -s \"Trellis Index Error\" admin@example.com\nfi\n</code></pre> <p>Crontab: <pre><code>*/5 * * * * /path/to/index-update-cron.sh\n</code></pre></p>"},{"location":"maintenance/indexing/#monitor-index-size","title":"Monitor Index Size","text":"<pre><code>#!/bin/bash\n# check-index-size.sh\n\nSITE_DIR=\"/var/www/trellis_data\"\n\necho \"Index Sizes:\"\ndu -sh \"$SITE_DIR/search_index\"\ndu -sh \"$SITE_DIR/trellis_content.db\"\n\n# Alert if too large\nSEARCH_SIZE=$(du -sm \"$SITE_DIR/search_index\" | cut -f1)\nif [ $SEARCH_SIZE -gt 1000 ]; then\n  echo \"Warning: Search index is very large ($SEARCH_SIZE MB)\"\nfi\n</code></pre>"},{"location":"maintenance/indexing/#troubleshooting","title":"Troubleshooting","text":""},{"location":"maintenance/indexing/#search-returns-no-results","title":"Search Returns No Results","text":"<pre><code># Rebuild search index\ntrellis-search --rebuild\n\n# Check index stats\ntrellis-search --stats\n\n# If stats show 0 documents, check content directory\nls -R content/\n</code></pre>"},{"location":"maintenance/indexing/#wiki-links-not-resolving","title":"Wiki-Links Not Resolving","text":"<pre><code># Rebuild content index\ntrellis-index --clear\n\n# Check index stats\ntrellis-index --stats\n\n# Verify articles are indexed\nsqlite3 trellis_content.db \"SELECT COUNT(*) FROM articles;\"\n</code></pre>"},{"location":"maintenance/indexing/#index-corruption","title":"Index Corruption","text":"<pre><code># Remove corrupted indexes\nrm -rf search_index/\nrm -f trellis_content.db\n\n# Rebuild from scratch\ntrellis-search --rebuild\ntrellis-index --clear\n</code></pre>"},{"location":"maintenance/indexing/#cron-job-not-running","title":"Cron Job Not Running","text":"<pre><code># Check cron logs\ngrep CRON /var/log/syslog\n\n# Test manually\ntrellis-index-update\n\n# Check permissions\nls -l $(which trellis-index-update)\n</code></pre>"},{"location":"maintenance/indexing/#database-locked","title":"Database Locked","text":"<pre><code># Check for running processes\nps aux | grep trellis\n\n# Kill stale processes\npkill -f trellis-index-update\n\n# Retry\ntrellis-index-update --force\n</code></pre>"},{"location":"maintenance/indexing/#out-of-disk-space","title":"Out of Disk Space","text":"<pre><code># Check index sizes\ndu -sh search_index/ trellis_content.db\n\n# Clean and rebuild\nrm -rf search_index/\ntrellis-search --rebuild\n</code></pre>"},{"location":"maintenance/indexing/#advanced-topics","title":"Advanced Topics","text":""},{"location":"maintenance/indexing/#custom-search-schema","title":"Custom Search Schema","text":"<p>For advanced users, you can customize the Whoosh schema in <code>trellis/utils/search_handler.py</code>:</p> <pre><code>schema = Schema(\n    path=ID(stored=True, unique=True),\n    title=TEXT(stored=True),\n    content=TEXT(stored=True),\n    tags=KEYWORD(stored=True, commas=True),\n    published_date=DATETIME(stored=True),\n    # Add custom fields here\n)\n</code></pre>"},{"location":"maintenance/indexing/#query-optimization","title":"Query Optimization","text":"<p>Search queries support:</p> <ul> <li>Phrase search: <code>\"exact phrase\"</code></li> <li>Wildcards: <code>python*</code> matches \"python\", \"pythonic\"</li> <li>Boolean: <code>python AND flask</code>, <code>python OR javascript</code></li> <li>Field search: <code>title:python</code>, <code>tags:tutorial</code></li> </ul> <p>Example complex query: <pre><code>title:python AND (flask OR django) -beginner\n</code></pre></p>"},{"location":"maintenance/indexing/#index-backup","title":"Index Backup","text":"<p>Include indexes in backups for faster restoration:</p> <pre><code># Backup with indexes\nrsync -av \\\n  --include=\"search_index/\" \\\n  --include=\"trellis_content.db\" \\\n  /path/to/site/ \\\n  /backup/trellis/\n</code></pre> <p>Or exclude and rebuild after restore (saves space):</p> <pre><code># Backup without indexes (smaller)\nrsync -av \\\n  --exclude=\"search_index/\" \\\n  --exclude=\"trellis_content.db\" \\\n  /path/to/site/ \\\n  /backup/trellis/\n\n# After restore\ntrellis-index-update --force\n</code></pre>"},{"location":"maintenance/indexing/#best-practices","title":"Best Practices","text":"<p>Development: - Use immediate mode - Rebuild after bulk imports - Test search after changes</p> <p>Production: - Use deferred mode for high-traffic sites - Cron every 5 minutes - Monitor cron logs - Alert on failures</p> <p>Maintenance: - Rebuild indexes after restoration - Verify with <code>--stats</code> commands - Include in monitoring scripts - Document rebuild procedures</p> <p>Performance: - Use immediate mode for &lt; 1000 articles - Use deferred mode for &gt;= 1000 articles - Monitor index sizes - Optimize search queries</p>"},{"location":"maintenance/indexing/#next-steps","title":"Next Steps","text":"<ul> <li>Backup Strategy - Protect your content</li> <li>Updates - Keeping Trellis up to date</li> <li>Deployment - Production setup</li> </ul>"},{"location":"maintenance/updates/","title":"Updates","text":"<p>Keeping Trellis CMS up to date.</p>"},{"location":"maintenance/updates/#checking-current-version","title":"Checking Current Version","text":"<pre><code>pip show trellis-cms\n</code></pre> <p>Output: <pre><code>Name: trellis-cms\nVersion: 0.3.0\n...\n</code></pre></p>"},{"location":"maintenance/updates/#updating-trellis","title":"Updating Trellis","text":""},{"location":"maintenance/updates/#from-pypi","title":"From PyPI","text":"<pre><code>pip install --upgrade trellis-cms\n</code></pre>"},{"location":"maintenance/updates/#from-source","title":"From Source","text":"<pre><code>cd /path/to/trellis\ngit pull origin main\npip install --upgrade -e .\n</code></pre>"},{"location":"maintenance/updates/#version-history","title":"Version History","text":""},{"location":"maintenance/updates/#v030-2026-01-09","title":"v0.3.0 (2026-01-09)","text":"<ul> <li>Improved documentation with MkDocs</li> <li>Enhanced backup strategies</li> <li>Better indexing performance</li> <li>Bug fixes and stability improvements</li> </ul>"},{"location":"maintenance/updates/#v021-2024-11-25","title":"v0.2.1 (2024-11-25)","text":"<ul> <li>Added commenting system integration</li> <li>Improved user management</li> <li>Added email capabilities</li> <li>Wiki-links for internal linking</li> </ul>"},{"location":"maintenance/updates/#v020-2024-11-22","title":"v0.2.0 (2024-11-22)","text":"<ul> <li>Published to PyPI as <code>trellis-cms</code></li> <li>Command-line tools: <code>trellis-init-db</code>, <code>trellis-search</code>, etc.</li> <li>Production-ready deployment support</li> </ul>"},{"location":"maintenance/updates/#v010-2024-10-15","title":"v0.1.0 (2024-10-15)","text":"<ul> <li>Initial release</li> <li>Basic digital garden functionality</li> <li>Markdown rendering with frontmatter</li> <li>User authentication</li> <li>Git integration</li> </ul>"},{"location":"maintenance/updates/#breaking-changes","title":"Breaking Changes","text":""},{"location":"maintenance/updates/#v030","title":"v0.3.0","text":"<p>No breaking changes. Fully backward compatible with v0.2.x.</p>"},{"location":"maintenance/updates/#v020","title":"v0.2.0","text":"<ul> <li>Command names changed: Old scripts renamed to CLI commands</li> <li><code>init_db.py</code> \u2192 <code>trellis-init-db</code></li> <li><code>rebuild_search.py</code> \u2192 <code>trellis-search --rebuild</code></li> </ul>"},{"location":"maintenance/updates/#update-process","title":"Update Process","text":""},{"location":"maintenance/updates/#1-backup-first","title":"1. Backup First","text":"<p>Always backup before updating:</p> <pre><code># Backup your data\n./backup-trellis.sh\n\n# Or manual backup\ncp -r /path/to/site /backup/site-$(date +%Y%m%d)\n</code></pre>"},{"location":"maintenance/updates/#2-check-changelog","title":"2. Check Changelog","text":"<p>Read the changelog for breaking changes:</p> <pre><code># On GitHub\nhttps://github.com/almargolis/trellis/blob/main/CHANGELOG.md\n</code></pre>"},{"location":"maintenance/updates/#3-update-dependencies","title":"3. Update Dependencies","text":"<pre><code># Update Trellis\npip install --upgrade trellis-cms\n\n# Check dependencies\npip check\n</code></pre>"},{"location":"maintenance/updates/#4-run-migrations","title":"4. Run Migrations","text":"<p>If database changes are needed:</p> <pre><code># Check for migration scripts\nls -l /path/to/trellis/migrations/\n\n# Run migrations if any\ntrellis-migrate  # (future feature)\n</code></pre>"},{"location":"maintenance/updates/#5-rebuild-indexes","title":"5. Rebuild Indexes","text":"<p>After major updates:</p> <pre><code>trellis-search --rebuild\ntrellis-index --clear\n</code></pre>"},{"location":"maintenance/updates/#6-test-locally","title":"6. Test Locally","text":"<pre><code># Run development server\npython run.py\n\n# Test in browser\n# - Login works\n# - Content displays\n# - Search works\n# - Editor works\n</code></pre>"},{"location":"maintenance/updates/#7-deploy-to-production","title":"7. Deploy to Production","text":"<pre><code># Stop service\nsudo systemctl stop trellis\n\n# Update code (if from source)\ncd /var/www/trellis\ngit pull origin main\npip install --upgrade -e .\n\n# Restart service\nsudo systemctl start trellis\n\n# Verify\nsudo systemctl status trellis\n</code></pre>"},{"location":"maintenance/updates/#updating-dependencies","title":"Updating Dependencies","text":""},{"location":"maintenance/updates/#update-all-dependencies","title":"Update All Dependencies","text":"<pre><code>pip install --upgrade trellis-cms\n</code></pre> <p>This updates Trellis and all its dependencies.</p>"},{"location":"maintenance/updates/#update-specific-dependency","title":"Update Specific Dependency","text":"<pre><code>pip install --upgrade Flask\npip install --upgrade Markdown\n</code></pre>"},{"location":"maintenance/updates/#check-for-outdated-packages","title":"Check for Outdated Packages","text":"<pre><code>pip list --outdated\n</code></pre>"},{"location":"maintenance/updates/#rolling-back","title":"Rolling Back","text":""},{"location":"maintenance/updates/#to-previous-version","title":"To Previous Version","text":"<pre><code># Install specific version\npip install trellis-cms==0.2.1\n\n# Rebuild indexes\ntrellis-search --rebuild\n</code></pre>"},{"location":"maintenance/updates/#from-backup","title":"From Backup","text":"<pre><code># Stop service\nsudo systemctl stop trellis\n\n# Restore from backup\nrsync -av /backup/site-20260109/ /path/to/site/\n\n# Restart service\nsudo systemctl start trellis\n</code></pre>"},{"location":"maintenance/updates/#automated-updates","title":"Automated Updates","text":""},{"location":"maintenance/updates/#dependabot-github","title":"Dependabot (GitHub)","text":"<p>Create <code>.github/dependabot.yml</code>:</p> <pre><code>version: 2\nupdates:\n  - package-ecosystem: \"pip\"\n    directory: \"/\"\n    schedule:\n      interval: \"weekly\"\n</code></pre>"},{"location":"maintenance/updates/#renovate-bot","title":"Renovate Bot","text":"<p>Create <code>renovate.json</code>:</p> <pre><code>{\n  \"extends\": [\"config:base\"],\n  \"python\": {\n    \"enabled\": true\n  }\n}\n</code></pre>"},{"location":"maintenance/updates/#security-updates","title":"Security Updates","text":""},{"location":"maintenance/updates/#check-for-vulnerabilities","title":"Check for Vulnerabilities","text":"<pre><code>pip install safety\nsafety check\n</code></pre>"},{"location":"maintenance/updates/#update-security-fixes-only","title":"Update Security Fixes Only","text":"<pre><code># Update Flask (example security fix)\npip install --upgrade Flask&gt;=3.0.1\n</code></pre>"},{"location":"maintenance/updates/#monitor-security-advisories","title":"Monitor Security Advisories","text":"<p>Subscribe to: - GitHub Security Advisories - PyPI security feed - Flask security mailing list</p>"},{"location":"maintenance/updates/#production-update-checklist","title":"Production Update Checklist","text":"<ul> <li>[ ] Read changelog and release notes</li> <li>[ ] Backup data directory</li> <li>[ ] Test in staging environment</li> <li>[ ] Schedule maintenance window</li> <li>[ ] Notify users of downtime</li> <li>[ ] Update application</li> <li>[ ] Run migrations if needed</li> <li>[ ] Rebuild indexes</li> <li>[ ] Test all functionality</li> <li>[ ] Monitor error logs</li> <li>[ ] Verify search and links work</li> <li>[ ] Confirm user login works</li> </ul>"},{"location":"maintenance/updates/#troubleshooting","title":"Troubleshooting","text":""},{"location":"maintenance/updates/#dependency-conflicts","title":"Dependency Conflicts","text":"<pre><code># List installed versions\npip list\n\n# Check conflicts\npip check\n\n# Resolve conflicts\npip install --upgrade --force-reinstall trellis-cms\n</code></pre>"},{"location":"maintenance/updates/#import-errors-after-update","title":"Import Errors After Update","text":"<pre><code># Clear Python cache\nfind . -type d -name \"__pycache__\" -exec rm -rf {} +\nfind . -type f -name \"*.pyc\" -delete\n\n# Reinstall\npip uninstall trellis-cms\npip install trellis-cms\n</code></pre>"},{"location":"maintenance/updates/#database-errors-after-update","title":"Database Errors After Update","text":"<pre><code># Check database integrity\nsqlite3 trellis_admin.db \"PRAGMA integrity_check;\"\n\n# Restore from backup if needed\ncp /backup/trellis_admin.db .\n</code></pre>"},{"location":"maintenance/updates/#service-wont-start","title":"Service Won't Start","text":"<pre><code># Check logs\nsudo journalctl -u trellis -n 50\n\n# Verify Python environment\nwhich python3\npython3 -c \"import trellis; print(trellis.__version__)\"\n\n# Check permissions\nls -la /path/to/site\n</code></pre>"},{"location":"maintenance/updates/#best-practices","title":"Best Practices","text":"<p>Before updating: - Always backup - Test in development first - Read release notes - Check for breaking changes</p> <p>During updates: - Use maintenance mode - Monitor error logs - Have rollback plan ready</p> <p>After updating: - Test thoroughly - Rebuild indexes - Verify backups work - Monitor performance</p> <p>Frequency: - Security updates: Immediately - Feature updates: Monthly or quarterly - Major versions: Plan carefully</p>"},{"location":"maintenance/updates/#development-updates","title":"Development Updates","text":"<p>For developers working on Trellis itself:</p> <pre><code># Update from git\ncd /path/to/trellis\ngit pull origin main\n\n# Update dependencies\npip install --upgrade -e .\n\n# Run tests\npytest\n\n# Check for issues\nflake8 trellis/\n</code></pre>"},{"location":"maintenance/updates/#next-steps","title":"Next Steps","text":"<ul> <li>Backup Strategy - Protect your content</li> <li>Search Indexing - Manage indexes</li> <li>Deployment - Production setup</li> </ul>"},{"location":"reference/api/","title":"API Reference","text":"<p>Code-level documentation for Trellis CMS modules and classes.</p>"},{"location":"reference/api/#core-modules","title":"Core Modules","text":""},{"location":"reference/api/#trellis","title":"trellis","text":"<p>Main application module.</p>"},{"location":"reference/api/#create_appconfignone","title":"create_app(config=None)","text":"<p>Create and configure Flask application instance.</p> <p>Parameters: - <code>config</code> (dict, optional): Configuration overrides</p> <p>Returns: - <code>Flask</code>: Configured Flask application</p> <p>Example: <pre><code>from trellis import create_app\n\napp = create_app()\n\nif __name__ == '__main__':\n    app.run(debug=True)\n</code></pre></p>"},{"location":"reference/api/#utility-classes","title":"Utility Classes","text":""},{"location":"reference/api/#markdownhandler","title":"MarkdownHandler","text":"<p>Handle markdown file I/O and processing.</p> <p>Location: <code>trellis/utils/markdown_handler.py</code></p>"},{"location":"reference/api/#__init__content_dir","title":"__init__(content_dir)","text":"<p>Initialize markdown handler.</p> <p>Parameters: - <code>content_dir</code> (str): Path to content directory</p> <pre><code>from trellis.utils.markdown_handler import MarkdownHandler\n\nhandler = MarkdownHandler('/path/to/content')\n</code></pre>"},{"location":"reference/api/#parse_filefile_path","title":"parse_file(file_path)","text":"<p>Read and parse markdown file with frontmatter.</p> <p>Parameters: - <code>file_path</code> (str): Path to markdown file</p> <p>Returns: - <code>tuple</code>: (metadata dict, content string)</p> <p>Example: <pre><code>metadata, content = handler.parse_file('content/blog/article.md')\n\nprint(metadata['title'])\nprint(content)\n</code></pre></p> <p>Metadata Fields: - <code>title</code> (str): Article title - <code>published_date</code> (str): Publication date - <code>created_date</code> (str): Creation date - <code>updated_date</code> (str): Last update date - <code>tags</code> (list): List of tags - <code>status</code> (str): 'published' or 'draft'</p>"},{"location":"reference/api/#save_filefile_path-metadata-content","title":"save_file(file_path, metadata, content)","text":"<p>Save markdown file with frontmatter.</p> <p>Parameters: - <code>file_path</code> (str): Path to save file - <code>metadata</code> (dict): Frontmatter metadata - <code>content</code> (str): Markdown content</p> <p>Returns: - <code>bool</code>: True if successful</p> <p>Example: <pre><code>metadata = {\n    'title': 'My Article',\n    'published_date': '2026-01-09',\n    'tags': ['python', 'flask'],\n    'status': 'published'\n}\n\ncontent = \"# Hello\\n\\nThis is content.\"\n\nhandler.save_file('content/blog/article.md', metadata, content)\n</code></pre></p>"},{"location":"reference/api/#convert_markdowntext-garden_slugnone-article_slugnone","title":"convert_markdown(text, garden_slug=None, article_slug=None)","text":"<p>Convert markdown to HTML with extensions.</p> <p>Parameters: - <code>text</code> (str): Markdown text - <code>garden_slug</code> (str, optional): Garden slug for wiki-link resolution - <code>article_slug</code> (str, optional): Article slug for wiki-link resolution</p> <p>Returns: - <code>str</code>: HTML string</p> <p>Example: <pre><code>html = handler.convert_markdown(\"# Hello\\n\\nThis is **bold**.\")\n</code></pre></p> <p>Features: - Code syntax highlighting - Tables, footnotes, TOC - Wiki-link resolution: <code>[[Page Title]]</code> - Include file processing: <code>{{include: file.py}}</code></p>"},{"location":"reference/api/#list_articlesgarden_path-recursivetrue","title":"list_articles(garden_path, recursive=True)","text":"<p>List all articles in a garden.</p> <p>Parameters: - <code>garden_path</code> (str): Path to garden directory - <code>recursive</code> (bool): Include nested pages</p> <p>Returns: - <code>list</code>: List of article file paths</p> <p>Example: <pre><code>articles = handler.list_articles('content/blog')\nfor article in articles:\n    print(article)\n</code></pre></p>"},{"location":"reference/api/#gardenmanager","title":"GardenManager","text":"<p>Manage garden directories and configuration.</p> <p>Location: <code>trellis/utils/garden_manager.py</code></p>"},{"location":"reference/api/#__init__content_dir_1","title":"__init__(content_dir)","text":"<p>Initialize garden manager.</p> <p>Parameters: - <code>content_dir</code> (str): Path to content directory</p> <pre><code>from trellis.utils.garden_manager import GardenManager\n\nmanager = GardenManager('/path/to/content')\n</code></pre>"},{"location":"reference/api/#list_gardens","title":"list_gardens()","text":"<p>Get all gardens with their configurations.</p> <p>Returns: - <code>list</code>: List of garden dicts with 'slug', 'title', 'description', 'order'</p> <p>Example: <pre><code>gardens = manager.list_gardens()\n\nfor garden in gardens:\n    print(f\"{garden['title']}: {garden['description']}\")\n</code></pre></p>"},{"location":"reference/api/#get_hierarchygarden_slug","title":"get_hierarchy(garden_slug)","text":"<p>Build hierarchical tree of articles in a garden.</p> <p>Parameters: - <code>garden_slug</code> (str): Garden identifier</p> <p>Returns: - <code>dict</code>: Nested dictionary representing article hierarchy</p> <p>Example: <pre><code>tree = manager.get_hierarchy('blog')\n\n# tree structure:\n# {\n#   'article.md': {...},\n#   'project.page': {\n#     'page.md': {...},\n#     'setup.page': {\n#       'page.md': {...}\n#     }\n#   }\n# }\n</code></pre></p>"},{"location":"reference/api/#get_breadcrumbspath","title":"get_breadcrumbs(path)","text":"<p>Generate breadcrumb trail for a path.</p> <p>Parameters: - <code>path</code> (str): Article path (e.g., 'blog/article' or 'projects/my-app/setup')</p> <p>Returns: - <code>list</code>: List of (title, url) tuples</p> <p>Example: <pre><code>breadcrumbs = manager.get_breadcrumbs('projects/my-app/setup')\n\n# [\n#   ('Home', '/'),\n#   ('Projects', '/garden/projects'),\n#   ('My App', '/garden/projects/my-app'),\n#   ('Setup', '/garden/projects/my-app/setup')\n# ]\n</code></pre></p>"},{"location":"reference/api/#get_article_pathgarden_slug-article_slug","title":"get_article_path(garden_slug, article_slug)","text":"<p>Resolve article slug to file path.</p> <p>Parameters: - <code>garden_slug</code> (str): Garden identifier - <code>article_slug</code> (str): Article identifier</p> <p>Returns: - <code>str</code>: Full file path to article</p> <p>Example: <pre><code>path = manager.get_article_path('blog', 'hello-world')\n# Returns: 'content/blog/hello-world.md' or 'content/blog/hello-world.page/page.md'\n</code></pre></p>"},{"location":"reference/api/#searchhandler","title":"SearchHandler","text":"<p>Full-text search with Whoosh.</p> <p>Location: <code>trellis/utils/search_handler.py</code></p>"},{"location":"reference/api/#__init__index_dir-content_dir","title":"__init__(index_dir, content_dir)","text":"<p>Initialize search handler.</p> <p>Parameters: - <code>index_dir</code> (str): Path to search index directory - <code>content_dir</code> (str): Path to content directory</p> <pre><code>from trellis.utils.search_handler import SearchHandler\n\nhandler = SearchHandler('/path/to/search_index', '/path/to/content')\n</code></pre>"},{"location":"reference/api/#rebuild_index","title":"rebuild_index()","text":"<p>Rebuild entire search index from content.</p> <p>Returns: - <code>int</code>: Number of documents indexed</p> <p>Example: <pre><code>count = handler.rebuild_index()\nprint(f\"Indexed {count} documents\")\n</code></pre></p>"},{"location":"reference/api/#searchquery_string-limit50","title":"search(query_string, limit=50)","text":"<p>Execute search query.</p> <p>Parameters: - <code>query_string</code> (str): Search query - <code>limit</code> (int): Maximum results to return</p> <p>Returns: - <code>list</code>: List of result dicts with 'title', 'path', 'content', 'score'</p> <p>Example: <pre><code>results = handler.search(\"python flask\", limit=10)\n\nfor result in results:\n    print(f\"{result['title']} - Score: {result['score']}\")\n</code></pre></p> <p>Query Syntax: - Simple: <code>python flask</code> - Phrase: <code>\"exact phrase\"</code> - Boolean: <code>python AND flask</code>, <code>python OR javascript</code> - Field: <code>title:python</code>, <code>tags:tutorial</code> - Wildcard: <code>python*</code></p>"},{"location":"reference/api/#add_documentdoc","title":"add_document(doc)","text":"<p>Add or update document in index.</p> <p>Parameters: - <code>doc</code> (dict): Document with 'path', 'title', 'content', etc.</p> <p>Example: <pre><code>doc = {\n    'path': 'blog/article',\n    'title': 'My Article',\n    'content': 'Article content here',\n    'tags': ['python', 'flask'],\n    'published_date': datetime(2026, 1, 9),\n    'garden_slug': 'blog'\n}\n\nhandler.add_document(doc)\n</code></pre></p>"},{"location":"reference/api/#get_stats","title":"get_stats()","text":"<p>Get search index statistics.</p> <p>Returns: - <code>dict</code>: Stats with 'doc_count', 'index_size', 'last_updated'</p> <p>Example: <pre><code>stats = handler.get_stats()\nprint(f\"Total documents: {stats['doc_count']}\")\nprint(f\"Index size: {stats['index_size']} bytes\")\n</code></pre></p>"},{"location":"reference/api/#githandler","title":"GitHandler","text":"<p>Git integration for version control.</p> <p>Location: <code>trellis/utils/git_handler.py</code></p>"},{"location":"reference/api/#__init__repo_path","title":"__init__(repo_path)","text":"<p>Initialize git handler.</p> <p>Parameters: - <code>repo_path</code> (str): Path to git repository</p> <pre><code>from trellis.utils.git_handler import GitHandler\n\nhandler = GitHandler('/path/to/repo')\n</code></pre>"},{"location":"reference/api/#auto_commitfile_path-messagenone","title":"auto_commit(file_path, message=None)","text":"<p>Commit a single file change.</p> <p>Parameters: - <code>file_path</code> (str): Path to file (relative to repo) - <code>message</code> (str, optional): Commit message (auto-generated if None)</p> <p>Returns: - <code>bool</code>: True if committed, False if nothing to commit</p> <p>Example: <pre><code>handler.auto_commit('content/blog/article.md', 'Update article')\n</code></pre></p> <p>Auto-generated message format: <pre><code>Update: content/blog/article.md\n</code></pre></p>"},{"location":"reference/api/#pushremoteorigin-branchmain","title":"push(remote='origin', branch='main')","text":"<p>Push commits to remote.</p> <p>Parameters: - <code>remote</code> (str): Remote name - <code>branch</code> (str): Branch name</p> <p>Returns: - <code>bool</code>: True if successful</p> <p>Example: <pre><code>handler.push('origin', 'main')\n</code></pre></p>"},{"location":"reference/api/#pullremoteorigin-branchmain","title":"pull(remote='origin', branch='main')","text":"<p>Pull changes from remote.</p> <p>Parameters: - <code>remote</code> (str): Remote name - <code>branch</code> (str): Branch name</p> <p>Returns: - <code>bool</code>: True if successful</p> <pre><code>handler.pull('origin', 'main')\n</code></pre>"},{"location":"reference/api/#get_loglimit10","title":"get_log(limit=10)","text":"<p>Get commit history.</p> <p>Parameters: - <code>limit</code> (int): Number of commits</p> <p>Returns: - <code>list</code>: List of commit dicts with 'sha', 'message', 'author', 'date'</p> <p>Example: <pre><code>commits = handler.get_log(5)\n\nfor commit in commits:\n    print(f\"{commit['sha'][:7]} - {commit['message']}\")\n</code></pre></p>"},{"location":"reference/api/#datemanager","title":"DateManager","text":"<p>Manage article dates and timestamps.</p> <p>Location: <code>trellis/utils/date_manager.py</code></p>"},{"location":"reference/api/#auto_update_modifiedmetadata","title":"auto_update_modified(metadata)","text":"<p>Automatically set updated_date to today.</p> <p>Parameters: - <code>metadata</code> (dict): Article metadata (modified in place)</p> <p>Returns: - <code>dict</code>: Updated metadata</p> <p>Example: <pre><code>from trellis.utils.date_manager import DateManager\n\nmetadata = {\n    'title': 'My Article',\n    'published_date': '2026-01-09'\n}\n\nDateManager.auto_update_modified(metadata)\n\nprint(metadata['updated_date'])  # Today's date\n</code></pre></p>"},{"location":"reference/api/#format_datedate_str-formaty-m-d","title":"format_date(date_str, format='%Y-%m-%d')","text":"<p>Format date string.</p> <p>Parameters: - <code>date_str</code> (str): Date string - <code>format</code> (str): Output format</p> <p>Returns: - <code>str</code>: Formatted date</p> <p>Example: <pre><code>formatted = DateManager.format_date('2026-01-09', '%B %d, %Y')\nprint(formatted)  # \"January 09, 2026\"\n</code></pre></p>"},{"location":"reference/api/#indexmanager","title":"IndexManager","text":"<p>Coordinate search and content indexes.</p> <p>Location: <code>trellis/utils/index_manager.py</code></p>"},{"location":"reference/api/#__init__data_dir-content_dir","title":"__init__(data_dir, content_dir)","text":"<p>Initialize index manager.</p> <p>Parameters: - <code>data_dir</code> (str): Path to data directory - <code>content_dir</code> (str): Path to content directory</p> <pre><code>from trellis.utils.index_manager import IndexManager\n\nmanager = IndexManager('/path/to/data', '/path/to/content')\n</code></pre>"},{"location":"reference/api/#update_single_filefile_path","title":"update_single_file(file_path)","text":"<p>Update indexes for a single file.</p> <p>Parameters: - <code>file_path</code> (str): Path to changed file</p> <p>Example: <pre><code>manager.update_single_file('content/blog/article.md')\n</code></pre></p> <p>This updates both search index and content index.</p>"},{"location":"reference/api/#rebuild_all","title":"rebuild_all()","text":"<p>Rebuild both indexes from scratch.</p> <p>Example: <pre><code>manager.rebuild_all()\n</code></pre></p>"},{"location":"reference/api/#mark_dirty","title":"mark_dirty()","text":"<p>Set dirty flag for deferred updates.</p> <p>Example: <pre><code># In deferred mode\nmanager.mark_dirty()\n\n# Cron job later checks flag and rebuilds\n</code></pre></p>"},{"location":"reference/api/#cli-commands","title":"CLI Commands","text":""},{"location":"reference/api/#trellis-init-db","title":"trellis-init-db","text":"<p>Initialize database with default admin user.</p> <pre><code>trellis-init-db\n</code></pre> <p>Creates <code>trellis_admin.db</code> with: - Admin user: <code>admin</code> / <code>admin</code></p>"},{"location":"reference/api/#trellis-search","title":"trellis-search","text":"<p>Search index management.</p> <pre><code># Rebuild search index\ntrellis-search --rebuild\n\n# Show statistics\ntrellis-search --stats\n</code></pre>"},{"location":"reference/api/#trellis-index","title":"trellis-index","text":"<p>Content index management.</p> <pre><code># Rebuild content index\ntrellis-index --clear\n\n# Show statistics\ntrellis-index --stats\n</code></pre>"},{"location":"reference/api/#trellis-index-update","title":"trellis-index-update","text":"<p>Update all indexes (checks dirty flag in deferred mode).</p> <pre><code># Check and update if needed\ntrellis-index-update\n\n# Force update\ntrellis-index-update --force\n</code></pre>"},{"location":"reference/api/#template-context","title":"Template Context","text":"<p>Templates have access to these variables:</p>"},{"location":"reference/api/#base-template-variables","title":"Base Template Variables","text":"<ul> <li><code>site_name</code> (str): Site name from config</li> <li><code>site_author</code> (str): Site author from config</li> <li><code>current_user</code>: Flask-Login user object</li> <li><code>gardens</code> (list): List of all gardens</li> </ul>"},{"location":"reference/api/#article-template-variables","title":"Article Template Variables","text":"<ul> <li><code>garden</code> (dict): Current garden info</li> <li><code>article</code> (dict): Article metadata</li> <li><code>content</code> (str): Rendered HTML content</li> <li><code>breadcrumbs</code> (list): Breadcrumb trail</li> <li><code>related_articles</code> (list): Related articles (if enabled)</li> </ul>"},{"location":"reference/api/#example-template","title":"Example Template","text":"<pre><code>{% extends \"base.html\" %}\n\n{% block content %}\n&lt;article&gt;\n    &lt;h1&gt;{{ article.title }}&lt;/h1&gt;\n\n    {% if article.published_date %}\n    &lt;time&gt;{{ article.published_date }}&lt;/time&gt;\n    {% endif %}\n\n    {% if article.tags %}\n    &lt;div class=\"tags\"&gt;\n        {% for tag in article.tags %}\n        &lt;span class=\"tag\"&gt;{{ tag }}&lt;/span&gt;\n        {% endfor %}\n    &lt;/div&gt;\n    {% endif %}\n\n    &lt;div class=\"content\"&gt;\n        {{ content | safe }}\n    &lt;/div&gt;\n&lt;/article&gt;\n{% endblock %}\n</code></pre>"},{"location":"reference/api/#configuration","title":"Configuration","text":""},{"location":"reference/api/#environment-variables","title":"Environment Variables","text":"<p>Configuration via <code>.env</code> file:</p> <pre><code>import os\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\nSECRET_KEY = os.getenv('SECRET_KEY')\nSITE_NAME = os.getenv('SITE_NAME', 'Trellis')\nDATA_DIR = os.getenv('DATA_DIR', '.')\nCONTENT_DIR = os.getenv('CONTENT_DIR', 'content')\n</code></pre>"},{"location":"reference/api/#config-class","title":"Config Class","text":"<p>Location: <code>trellis/config.py</code></p> <pre><code>class Config:\n    SECRET_KEY = os.getenv('SECRET_KEY', 'dev-secret')\n    SITE_NAME = os.getenv('SITE_NAME', 'Trellis')\n    SITE_AUTHOR = os.getenv('SITE_AUTHOR', '')\n\n    # Database\n    SQLALCHEMY_DATABASE_URI = f\"sqlite:///{DATA_DIR}/trellis_admin.db\"\n    SQLALCHEMY_TRACK_MODIFICATIONS = False\n\n    # Paths\n    DATA_DIR = os.getenv('DATA_DIR', '.')\n    CONTENT_DIR = os.getenv('CONTENT_DIR', 'content')\n\n    # Git\n    GITLAB_REPO_PATH = os.getenv('GITLAB_REPO_PATH', '.')\n\n    # Indexing\n    DEFERRED_INDEXING = os.getenv('TRELLIS_DEFERRED_INDEXING', 'false').lower() == 'true'\n</code></pre>"},{"location":"reference/api/#extension-integration","title":"Extension Integration","text":""},{"location":"reference/api/#adding-custom-blueprints","title":"Adding Custom Blueprints","text":"<pre><code>from flask import Blueprint\n\ncustom_bp = Blueprint('custom', __name__, template_folder='templates')\n\n@custom_bp.route('/custom')\ndef custom_page():\n    return render_template('custom.html')\n\n# In create_app()\napp.register_blueprint(custom_bp, url_prefix='/custom')\n</code></pre>"},{"location":"reference/api/#adding-custom-models","title":"Adding Custom Models","text":"<pre><code>from trellis.models import db\n\nclass CustomModel(db.Model):\n    __tablename__ = 'custom'\n\n    id = db.Column(db.Integer, primary_key=True)\n    name = db.Column(db.String(100))\n\n    def __repr__(self):\n        return f'&lt;CustomModel {self.name}&gt;'\n</code></pre>"},{"location":"reference/api/#custom-markdown-extensions","title":"Custom Markdown Extensions","text":"<pre><code>from markdown.extensions import Extension\n\nclass CustomExtension(Extension):\n    def extendMarkdown(self, md):\n        # Add custom processors\n        md.preprocessors.register(CustomPreprocessor(md), 'custom', 100)\n\n# Use in MarkdownHandler\nhandler.md = markdown.Markdown(extensions=[CustomExtension()])\n</code></pre>"},{"location":"reference/api/#error-handling","title":"Error Handling","text":""},{"location":"reference/api/#common-exceptions","title":"Common Exceptions","text":"<p>FileNotFoundError: <pre><code>try:\n    metadata, content = handler.parse_file('nonexistent.md')\nexcept FileNotFoundError:\n    # Handle missing file\n    pass\n</code></pre></p> <p>ValidationError: <pre><code>try:\n    handler.save_file(path, metadata, content)\nexcept ValidationError as e:\n    # Handle invalid data\n    print(f\"Validation error: {e}\")\n</code></pre></p>"},{"location":"reference/api/#custom-error-pages","title":"Custom Error Pages","text":"<pre><code>@app.errorhandler(404)\ndef not_found(error):\n    return render_template('404.html'), 404\n\n@app.errorhandler(500)\ndef internal_error(error):\n    db.session.rollback()\n    return render_template('500.html'), 500\n</code></pre>"},{"location":"reference/api/#testing","title":"Testing","text":""},{"location":"reference/api/#unit-tests","title":"Unit Tests","text":"<pre><code>import pytest\nfrom trellis.utils.markdown_handler import MarkdownHandler\n\ndef test_parse_frontmatter():\n    content = \"\"\"---\ntitle: Test\n---\nBody\"\"\"\n\n    handler = MarkdownHandler('/tmp')\n    metadata, body = handler.parse_file_content(content)\n\n    assert metadata['title'] == \"Test\"\n    assert body.strip() == \"Body\"\n</code></pre>"},{"location":"reference/api/#integration-tests","title":"Integration Tests","text":"<pre><code>def test_article_view(client):\n    response = client.get('/garden/blog/test-article')\n    assert response.status_code == 200\n    assert b'Test Article' in response.data\n</code></pre>"},{"location":"reference/api/#next-steps","title":"Next Steps","text":"<ul> <li>Architecture - System design</li> <li>Development - Development setup</li> <li>Deployment - Production deployment</li> </ul>"},{"location":"reference/architecture/","title":"Architecture","text":"<p>System architecture and design of Trellis CMS.</p>"},{"location":"reference/architecture/#overview","title":"Overview","text":"<p>Trellis is a Flask-based digital garden CMS with a focus on simplicity, markdown content, and hierarchical organization.</p>"},{"location":"reference/architecture/#high-level-architecture","title":"High-Level Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Web Browser                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                     \u2502 HTTP/HTTPS\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Web Server (Apache/Nginx)              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                     \u2502 WSGI\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                 Flask Application                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502            Blueprints                        \u2502  \u2502\n\u2502  \u2502  \u2022 main_bp (public routes)                   \u2502  \u2502\n\u2502  \u2502  \u2022 editor_bp (content editing)               \u2502  \u2502\n\u2502  \u2502  \u2022 auth_bp (authentication)                  \u2502  \u2502\n\u2502  \u2502  \u2022 comments_bp (commenting)                  \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502         Utility Modules                      \u2502  \u2502\n\u2502  \u2502  \u2022 MarkdownHandler (content processing)      \u2502  \u2502\n\u2502  \u2502  \u2022 GardenManager (directory management)      \u2502  \u2502\n\u2502  \u2502  \u2022 SearchHandler (full-text search)          \u2502  \u2502\n\u2502  \u2502  \u2022 GitHandler (version control)              \u2502  \u2502\n\u2502  \u2502  \u2022 IndexManager (index coordination)         \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n            \u2502                      \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   SQLite Databases   \u2502   \u2502    File System          \u2502\n\u2502  \u2022 trellis_admin.db  \u2502   \u2502  \u2022 content/ (markdown)  \u2502\n\u2502  \u2022 trellis_content.db\u2502   \u2502  \u2022 search_index/        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"reference/architecture/#application-factory-pattern","title":"Application Factory Pattern","text":"<p>Trellis uses Flask's application factory pattern for flexibility:</p> <pre><code># trellis/__init__.py\ndef create_app(config=None):\n    app = Flask(__name__, instance_relative_config=True)\n\n    # Configure app\n    app.config.from_object('trellis.config.Config')\n\n    # Initialize extensions\n    db.init_app(app)\n    login_manager.init_app(app)\n\n    # Register blueprints\n    app.register_blueprint(main_bp)\n    app.register_blueprint(editor_bp, url_prefix='/editor')\n    app.register_blueprint(auth_bp, url_prefix='/auth')\n\n    return app\n</code></pre> <p>Benefits: - Multiple app instances for testing - Different configs for dev/staging/prod - Easy to extend and customize</p>"},{"location":"reference/architecture/#blueprints","title":"Blueprints","text":""},{"location":"reference/architecture/#main_bp-public-routes","title":"main_bp (Public Routes)","text":"<p>Purpose: Public-facing content views</p> <p>Routes: - <code>/</code> - Garden index - <code>/garden/&lt;slug&gt;</code> - Garden view - <code>/garden/&lt;slug&gt;/&lt;path:article_path&gt;</code> - Article view - <code>/garden/&lt;slug&gt;/&lt;path:article_path&gt;/assets/&lt;filename&gt;</code> - Page assets - <code>/search</code> - Search results</p> <p>Key Features: - Read-only access (no authentication required) - Markdown rendering with wiki-links - Search functionality - Breadcrumb navigation</p>"},{"location":"reference/architecture/#editor_bp-content-editing","title":"editor_bp (Content Editing)","text":"<p>Purpose: Content management interface</p> <p>Routes: - <code>/editor/</code> - Editor dashboard - <code>/editor/edit/&lt;garden&gt;/&lt;path:article_path&gt;</code> - Edit article - <code>/editor/save</code> - Save article (AJAX) - <code>/editor/create</code> - Create article - <code>/editor/delete</code> - Delete article</p> <p>Key Features: - Login required (<code>@login_required</code>) - AJAX-based saving - Automatic git commits - Frontmatter editing - Index updates</p>"},{"location":"reference/architecture/#auth_bp-authentication","title":"auth_bp (Authentication)","text":"<p>Purpose: User management and authentication</p> <p>Routes: - <code>/auth/login</code> - Login page - <code>/auth/logout</code> - Logout - <code>/auth/change-password</code> - Change password - <code>/auth/users</code> - User management (admin only) - <code>/auth/users/add</code> - Add user (admin only) - <code>/auth/users/edit/&lt;id&gt;</code> - Edit user (admin only)</p> <p>Key Features: - Flask-Login integration - Role-based access (admin/editor) - Password hashing - Session management</p>"},{"location":"reference/architecture/#comments_bp-commenting","title":"comments_bp (Commenting)","text":"<p>Purpose: User comments on articles</p> <p>Provided by: qdcomments package</p> <p>Features: - Comment posting and moderation - Spam filtering - Email notifications - Comment approval workflow</p>"},{"location":"reference/architecture/#data-models","title":"Data Models","text":""},{"location":"reference/architecture/#user-model","title":"User Model","text":"<pre><code>class User(UserMixin, db.Model):\n    id = Column(Integer, primary_key=True)\n    username = Column(String(80), unique=True, nullable=False)\n    email = Column(String(120), unique=True, nullable=False)\n    password_hash = Column(String(255))\n    role = Column(String(20), default='editor')  # 'admin' or 'editor'\n    is_active = Column(Boolean, default=True)\n    created_at = Column(DateTime, default=datetime.utcnow)\n</code></pre> <p>Roles: - Admin: Full access (users, settings, content) - Editor: Content editing only</p>"},{"location":"reference/architecture/#content-model-metadata-cache","title":"Content Model (Metadata Cache)","text":"<pre><code>-- trellis_content.db\nCREATE TABLE articles (\n    id INTEGER PRIMARY KEY,\n    title TEXT NOT NULL,\n    slug TEXT NOT NULL,\n    garden_slug TEXT NOT NULL,\n    file_path TEXT NOT NULL,\n    content TEXT,\n    published_date TEXT,\n    created_date TEXT,\n    updated_date TEXT,\n    tags TEXT,\n    status TEXT,\n    UNIQUE(garden_slug, slug)\n);\n</code></pre> <p>Purpose: - Fast lookups for wiki-link resolution - Metadata queries without file I/O - Search result metadata</p>"},{"location":"reference/architecture/#content-processing-pipeline","title":"Content Processing Pipeline","text":""},{"location":"reference/architecture/#reading-content","title":"Reading Content","text":"<pre><code>1. Request: /garden/blog/article\n                    \u2193\n2. GardenManager.get_article_path()\n   \u2192 Resolves to: content/blog/article.md\n                    \u2193\n3. MarkdownHandler.parse_file()\n   \u2192 Reads file\n   \u2192 Parses YAML frontmatter\n   \u2192 Returns metadata + body\n                    \u2193\n4. MarkdownHandler._process_includes()\n   \u2192 Processes {{include: filename}}\n                    \u2193\n5. MarkdownHandler.convert_markdown()\n   \u2192 Converts markdown to HTML\n   \u2192 Processes wiki-links\n                    \u2193\n6. Template rendering\n   \u2192 Jinja2 template with HTML content\n</code></pre>"},{"location":"reference/architecture/#saving-content","title":"Saving Content","text":"<pre><code>1. Editor: POST /editor/save\n   { metadata: {...}, content: \"...\" }\n                    \u2193\n2. DateManager.auto_update_modified()\n   \u2192 Sets updated_date to now\n                    \u2193\n3. MarkdownHandler.save_file()\n   \u2192 Combines frontmatter + content\n   \u2192 Writes to .md file\n                    \u2193\n4. GitHandler.auto_commit()\n   \u2192 git add\n   \u2192 git commit -m \"Update: article.md\"\n                    \u2193\n5. IndexManager.update_single_file()\n   \u2192 Updates search index\n   \u2192 Updates content index\n                    \u2193\n6. Response: { success: true, metadata: {...} }\n</code></pre>"},{"location":"reference/architecture/#utility-modules","title":"Utility Modules","text":""},{"location":"reference/architecture/#markdownhandler","title":"MarkdownHandler","text":"<p>Purpose: Markdown processing and file I/O</p> <p>Key Methods: - <code>parse_file(file_path)</code> - Read and parse markdown with frontmatter - <code>save_file(file_path, metadata, content)</code> - Write markdown file - <code>convert_markdown(text)</code> - Convert markdown to HTML - <code>list_articles(garden_path)</code> - Find all articles in garden - <code>_process_includes(content, base_dir)</code> - Process include files</p> <p>Features: - YAML frontmatter parsing - Markdown extensions (code highlighting, tables, TOC) - Wiki-link resolution - Include file processing</p>"},{"location":"reference/architecture/#gardenmanager","title":"GardenManager","text":"<p>Purpose: Directory structure management</p> <p>Key Methods: - <code>list_gardens()</code> - Get all gardens with config - <code>get_hierarchy(garden_slug)</code> - Build hierarchical tree - <code>get_breadcrumbs(path)</code> - Generate breadcrumb trail - <code>get_article_path(garden, slug)</code> - Resolve article path</p> <p>Features: - Garden configuration (config.yaml) - Hierarchical navigation - URL slug generation - Path validation</p>"},{"location":"reference/architecture/#searchhandler","title":"SearchHandler","text":"<p>Purpose: Full-text search with Whoosh</p> <p>Key Methods: - <code>rebuild_index()</code> - Build index from all content - <code>search(query)</code> - Execute search query - <code>add_document(doc)</code> - Add/update document - <code>get_stats()</code> - Index statistics</p> <p>Features: - Full-text indexing - Fuzzy search - Field-specific search - Relevance ranking</p>"},{"location":"reference/architecture/#githandler","title":"GitHandler","text":"<p>Purpose: Version control integration</p> <p>Key Methods: - <code>auto_commit(file_path, message)</code> - Commit single file - <code>push()</code> - Push to remote - <code>pull()</code> - Pull from remote - <code>get_log(limit)</code> - Get commit history</p> <p>Features: - Automatic commits on save - Commit message generation - GitPython integration - Optional auto-push</p>"},{"location":"reference/architecture/#indexmanager","title":"IndexManager","text":"<p>Purpose: Coordinate search and content indexes</p> <p>Key Methods: - <code>update_single_file(file_path)</code> - Update indexes for one file - <code>rebuild_all()</code> - Rebuild both indexes - <code>mark_dirty()</code> - Set dirty flag for deferred updates</p> <p>Modes: - Immediate: Updates happen on save (default) - Deferred: Updates happen via cron job</p>"},{"location":"reference/architecture/#request-lifecycle","title":"Request Lifecycle","text":""},{"location":"reference/architecture/#public-article-view","title":"Public Article View","text":"<pre><code>1. User requests: /garden/blog/hello-world\n                    \u2193\n2. routes.article(garden_slug='blog', article_path='hello-world')\n                    \u2193\n3. GardenManager.get_article_path('blog', 'hello-world')\n   \u2192 Returns: content/blog/hello-world.md\n                    \u2193\n4. MarkdownHandler.parse_file('content/blog/hello-world.md')\n   \u2192 Returns: metadata, content\n                    \u2193\n5. Check status: if metadata['status'] != 'published' \u2192 403\n                    \u2193\n6. MarkdownHandler.convert_markdown(content)\n   \u2192 Returns: HTML\n                    \u2193\n7. render_template('article.html',\n                   title=metadata['title'],\n                   content=HTML,\n                   ...)\n                    \u2193\n8. Response: HTML page\n</code></pre>"},{"location":"reference/architecture/#editor-save","title":"Editor Save","text":"<pre><code>1. User clicks \"Save\" in editor\n   \u2192 AJAX POST to /editor/save\n   \u2192 { garden, path, metadata, content }\n                    \u2193\n2. @login_required \u2192 Check authentication\n                    \u2193\n3. DateManager.auto_update_modified(metadata)\n   \u2192 metadata['updated_date'] = today\n                    \u2193\n4. file_path = GardenManager.get_article_path(garden, path)\n                    \u2193\n5. MarkdownHandler.save_file(file_path, metadata, content)\n   \u2192 Writes file to disk\n                    \u2193\n6. GitHandler.auto_commit(file_path, \"Update: article.md\")\n   \u2192 git add + git commit\n                    \u2193\n7. IndexManager.update_single_file(file_path)\n   \u2192 Updates search and content indexes\n                    \u2193\n8. Response: JSON { success: true, metadata: {...} }\n                    \u2193\n9. JavaScript updates UI with new metadata\n</code></pre>"},{"location":"reference/architecture/#database-architecture","title":"Database Architecture","text":""},{"location":"reference/architecture/#two-database-design","title":"Two-Database Design","text":"<p>trellis_admin.db: - User accounts - Authentication data - User roles and permissions - Session data</p> <p>trellis_content.db: - Article metadata cache - Tag index - Wiki-link resolution - Search result metadata</p> <p>Why separate? - Different access patterns - Can rebuild content DB from files - Admin DB is critical (requires backup) - Content DB is cache (can regenerate)</p>"},{"location":"reference/architecture/#content-index-schema","title":"Content Index Schema","text":"<pre><code>CREATE TABLE articles (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    title TEXT NOT NULL,\n    slug TEXT NOT NULL,\n    garden_slug TEXT NOT NULL,\n    file_path TEXT NOT NULL,\n    content TEXT,\n    published_date TEXT,\n    created_date TEXT,\n    updated_date TEXT,\n    tags TEXT,  -- JSON array\n    status TEXT DEFAULT 'published',\n    last_indexed TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    UNIQUE(garden_slug, slug)\n);\n\nCREATE INDEX idx_slug ON articles(slug);\nCREATE INDEX idx_garden ON articles(garden_slug);\nCREATE INDEX idx_status ON articles(status);\nCREATE INDEX idx_published ON articles(published_date);\n</code></pre>"},{"location":"reference/architecture/#search-architecture","title":"Search Architecture","text":""},{"location":"reference/architecture/#whoosh-index-schema","title":"Whoosh Index Schema","text":"<pre><code>from whoosh.fields import Schema, ID, TEXT, DATETIME, KEYWORD\n\nschema = Schema(\n    path=ID(stored=True, unique=True),\n    title=TEXT(stored=True, field_boost=2.0),\n    content=TEXT(stored=True),\n    tags=KEYWORD(stored=True, commas=True, scorable=True),\n    published_date=DATETIME(stored=True),\n    garden_slug=ID(stored=True),\n)\n</code></pre> <p>Index Location: <code>DATA_DIR/search_index/</code></p> <p>Index Operations: - Add: New article created - Update: Article modified - Delete: Article deleted - Rebuild: Full index reconstruction</p>"},{"location":"reference/architecture/#security-architecture","title":"Security Architecture","text":""},{"location":"reference/architecture/#authentication-flow","title":"Authentication Flow","text":"<pre><code>1. User submits login form\n                    \u2193\n2. auth_bp.login()\n   \u2192 Validate credentials\n   \u2192 Check password hash\n                    \u2193\n3. Flask-Login: login_user(user)\n   \u2192 Creates session\n   \u2192 Sets session cookie\n                    \u2193\n4. Redirect to dashboard\n                    \u2193\n5. Subsequent requests include session cookie\n                    \u2193\n6. @login_required decorator\n   \u2192 Verifies session\n   \u2192 Loads user from database\n</code></pre>"},{"location":"reference/architecture/#authorization","title":"Authorization","text":"<p>Role-Based Access Control:</p> <pre><code>def admin_required(f):\n    @wraps(f)\n    def decorated_function(*args, **kwargs):\n        if not current_user.is_authenticated:\n            return redirect(url_for('auth.login'))\n        if current_user.role != 'admin':\n            abort(403)\n        return f(*args, **kwargs)\n    return decorated_function\n</code></pre> <p>Access Levels: - Public: View published content - Editor: Edit content, view drafts - Admin: User management, all editor permissions</p>"},{"location":"reference/architecture/#path-validation","title":"Path Validation","text":"<p>Prevent directory traversal attacks:</p> <pre><code>def validate_path(path):\n    \"\"\"Ensure path doesn't escape content directory\"\"\"\n    real_path = os.path.realpath(path)\n    content_dir = os.path.realpath(CONTENT_DIR)\n    if not real_path.startswith(content_dir):\n        abort(403)\n    return real_path\n</code></pre>"},{"location":"reference/architecture/#performance-considerations","title":"Performance Considerations","text":""},{"location":"reference/architecture/#caching-strategy","title":"Caching Strategy","text":"<p>Content: - No application-level cache (files are fast) - OS filesystem cache handles file reads - Web server caches static files</p> <p>Indexes: - In-memory SQLite queries (fast) - Whoosh index cached by OS</p> <p>Templates: - Jinja2 template compilation cache - Production: precompile templates</p>"},{"location":"reference/architecture/#scalability","title":"Scalability","text":"<p>Current Architecture: - Good for: 1-10 concurrent users - Good for: 1,000-10,000 articles - Bottleneck: SQLite write concurrency</p> <p>Scaling Options: - Add Redis for session storage - Use PostgreSQL instead of SQLite - Add application-level caching (Flask-Caching) - Serve static assets via CDN - Add load balancer for multiple app servers</p>"},{"location":"reference/architecture/#extension-points","title":"Extension Points","text":""},{"location":"reference/architecture/#custom-blueprints","title":"Custom Blueprints","text":"<pre><code>from flask import Blueprint\n\ncustom_bp = Blueprint('custom', __name__)\n\n@custom_bp.route('/custom')\ndef custom_route():\n    return \"Custom content\"\n\n# Register in create_app()\napp.register_blueprint(custom_bp)\n</code></pre>"},{"location":"reference/architecture/#custom-markdown-extensions","title":"Custom Markdown Extensions","text":"<pre><code>from markdown.extensions import Extension\n\nclass CustomExtension(Extension):\n    def extendMarkdown(self, md):\n        # Custom processing\n        pass\n\n# Use in MarkdownHandler\nmd = markdown.Markdown(extensions=[CustomExtension()])\n</code></pre>"},{"location":"reference/architecture/#custom-cli-commands","title":"Custom CLI Commands","text":"<pre><code># trellis/cli.py\nimport click\n\n@click.command()\ndef custom_command():\n    \"\"\"Custom CLI command\"\"\"\n    click.echo(\"Running custom command\")\n\n# Add to pyproject.toml\n[project.scripts]\ntrellis-custom = \"trellis.cli:custom_command\"\n</code></pre>"},{"location":"reference/architecture/#dependencies","title":"Dependencies","text":""},{"location":"reference/architecture/#core-dependencies","title":"Core Dependencies","text":"<ul> <li>Flask - Web framework</li> <li>Flask-Login - Authentication</li> <li>Flask-SQLAlchemy - ORM</li> <li>Markdown - Markdown processing</li> <li>Pygments - Syntax highlighting</li> <li>Whoosh - Full-text search</li> <li>GitPython - Git integration</li> <li>python-frontmatter - YAML frontmatter parsing</li> </ul>"},{"location":"reference/architecture/#optional-dependencies","title":"Optional Dependencies","text":"<ul> <li>qdflask - Reusable Flask utilities</li> <li>qdcomments - Commenting system</li> </ul>"},{"location":"reference/architecture/#next-steps","title":"Next Steps","text":"<ul> <li>Development Setup - Set up dev environment</li> <li>Deployment - Deploy to production</li> <li>API Reference - Code documentation</li> </ul>"},{"location":"reference/deployment/","title":"Deployment","text":"<p>Production deployment guide for Trellis CMS.</p>"},{"location":"reference/deployment/#overview","title":"Overview","text":"<p>Trellis can be deployed on any server that supports Python 3.9+ and either Apache/WSGI or Nginx/uWSGI.</p>"},{"location":"reference/deployment/#quick-deployment-checklist","title":"Quick Deployment Checklist","text":"<ul> <li>[ ] Python 3.9+ installed</li> <li>[ ] Web server (Apache or Nginx)</li> <li>[ ] WSGI server (mod_wsgi or uWSGI)</li> <li>[ ] SSL certificate configured</li> <li>[ ] Firewall rules configured</li> <li>[ ] Domain name pointed to server</li> </ul>"},{"location":"reference/deployment/#recommended-architecture","title":"Recommended Architecture","text":"<p>Production Setup: <pre><code>/var/www/mysite/          # Git repository (code, read-only)\n  .env                    # Configuration\n  trellis.wsgi           # WSGI entry point\n  venv/                  # Python virtual environment\n\n/var/www/mysite_data/    # Data directory (writable)\n  trellis_admin.db       # User database\n  trellis_content.db     # Content metadata cache\n  search_index/          # Whoosh search index\n  content/               # Markdown files\n    blog/\n    projects/\n</code></pre></p> <p>Why separate directories? - Code directory is owned by deployment user (read-only for www-data) - Data directory is owned by www-data (writable by web server) - Enables clean git pulls without permission issues - Databases can be written by web server</p>"},{"location":"reference/deployment/#apache-mod_wsgi-deployment","title":"Apache + mod_wsgi Deployment","text":""},{"location":"reference/deployment/#install-prerequisites","title":"Install Prerequisites","text":"<p>Ubuntu/Debian: <pre><code>sudo apt update\nsudo apt install python3 python3-pip python3-venv\nsudo apt install apache2 libapache2-mod-wsgi-py3\nsudo apt install git\n</code></pre></p> <p>RHEL/CentOS: <pre><code>sudo dnf install python3 python3-pip\nsudo dnf install httpd mod_wsgi\nsudo dnf install git\n</code></pre></p>"},{"location":"reference/deployment/#create-deployment-user","title":"Create Deployment User","text":"<pre><code># Optional: Create deployment user separate from www-data\nsudo adduser --system --group deploy\nsudo usermod -aG www-data deploy\n</code></pre>"},{"location":"reference/deployment/#clone-repository","title":"Clone Repository","text":"<pre><code>cd /var/www\nsudo git clone https://github.com/yourusername/your-site.git mysite\ncd mysite\n</code></pre>"},{"location":"reference/deployment/#install-trellis","title":"Install Trellis","text":"<pre><code># Create virtual environment\nsudo python3 -m venv venv\nsudo chown -R www-data:www-data venv\n\n# Activate and install\nsudo -u www-data venv/bin/pip install --upgrade pip\n\n# Install dependencies from GitHub (temporary, until on PyPI)\nsudo -u www-data venv/bin/pip install git+https://github.com/almargolis/quickdev.git#subdirectory=qdflask\nsudo -u www-data venv/bin/pip install git+https://github.com/almargolis/quickdev.git#subdirectory=qdcomments\n\n# Install Trellis\nsudo -u www-data venv/bin/pip install trellis-cms\n</code></pre> <p>Or install from local source: <pre><code># Install dependencies from GitHub\nsudo -u www-data venv/bin/pip install git+https://github.com/almargolis/quickdev.git#subdirectory=qdflask\nsudo -u www-data venv/bin/pip install git+https://github.com/almargolis/quickdev.git#subdirectory=qdcomments\n\n# Install Trellis in editable mode\nsudo -u www-data venv/bin/pip install -e /path/to/trellis\n</code></pre></p> <p>Future Simplified Installation</p> <p>Once qdflask and qdcomments are published to PyPI, installation will be: <pre><code>sudo -u www-data venv/bin/pip install trellis-cms\n</code></pre></p>"},{"location":"reference/deployment/#setup-data-directory","title":"Setup Data Directory","text":"<p>Use the included script: <pre><code>sudo ./setup_production.sh /var/www/mysite /var/www/mysite_data\n</code></pre></p> <p>Or manually: <pre><code>sudo mkdir -p /var/www/mysite_data/content\nsudo chown -R www-data:www-data /var/www/mysite_data\nsudo chmod -R 775 /var/www/mysite_data\n</code></pre></p>"},{"location":"reference/deployment/#configure-environment","title":"Configure Environment","text":"<p>Create <code>/var/www/mysite/.env</code>:</p> <pre><code># Security\nSECRET_KEY=your-secret-key-change-this-to-something-random\n\n# Site Information\nSITE_NAME=My Digital Garden\nSITE_AUTHOR=Your Name\n\n# Paths\nDATA_DIR=/var/www/mysite_data\nCONTENT_DIR=/var/www/mysite_data/content\n\n# Git Integration\nGITLAB_REPO_PATH=/var/www/mysite_data\n\n# Optional: Email (for commenting system)\nMAIL_SERVER=smtp.gmail.com\nMAIL_PORT=587\nMAIL_USE_TLS=True\nMAIL_USERNAME=your-email@gmail.com\nMAIL_PASSWORD=your-app-password\n\n# Optional: Deferred indexing for high-traffic sites\n# TRELLIS_DEFERRED_INDEXING=true\n</code></pre> <p>Generate a secret key: <pre><code>python3 -c \"import secrets; print(secrets.token_hex(32))\"\n</code></pre></p> <p>Secure the file: <pre><code>sudo chmod 600 /var/www/mysite/.env\nsudo chown www-data:www-data /var/www/mysite/.env\n</code></pre></p>"},{"location":"reference/deployment/#initialize-database","title":"Initialize Database","text":"<pre><code>cd /var/www/mysite\nsudo -u www-data venv/bin/trellis-init-db\n</code></pre> <p>Default credentials: <code>admin</code> / <code>admin</code> (change immediately!)</p>"},{"location":"reference/deployment/#copy-content","title":"Copy Content","text":"<pre><code># Copy your content to data directory\nsudo cp -r content/* /var/www/mysite_data/content/\nsudo chown -R www-data:www-data /var/www/mysite_data/content\n</code></pre> <p>Or sync from another location: <pre><code>sudo rsync -av /path/to/your/content/ /var/www/mysite_data/content/\nsudo chown -R www-data:www-data /var/www/mysite_data/content\n</code></pre></p>"},{"location":"reference/deployment/#build-search-index","title":"Build Search Index","text":"<pre><code>sudo -u www-data venv/bin/trellis-search --rebuild\n</code></pre>"},{"location":"reference/deployment/#create-wsgi-file","title":"Create WSGI File","text":"<p>Create <code>/var/www/mysite/trellis.wsgi</code>:</p> <pre><code>#!/usr/bin/env python3\nimport sys\nimport os\n\n# Project directory\nproject_home = '/var/www/mysite'\n\n# Change to project directory\nos.chdir(project_home)\n\n# Activate virtual environment\nactivate_this = os.path.join(project_home, 'venv', 'bin', 'activate_this.py')\nif os.path.exists(activate_this):\n    with open(activate_this) as f:\n        exec(f.read(), {'__file__': activate_this})\n\n# Load environment variables\nfrom dotenv import load_dotenv\nload_dotenv(os.path.join(project_home, '.env'))\n\n# Create Flask application\nfrom trellis import create_app\napplication = create_app()\n</code></pre>"},{"location":"reference/deployment/#configure-apache","title":"Configure Apache","text":"<p>Create <code>/etc/apache2/sites-available/mysite.conf</code>:</p> <pre><code>&lt;VirtualHost *:80&gt;\n    ServerName yourdomain.com\n    ServerAlias www.yourdomain.com\n\n    # Redirect to HTTPS\n    RewriteEngine On\n    RewriteCond %{HTTPS} off\n    RewriteRule ^(.*)$ https://%{HTTP_HOST}$1 [R=301,L]\n&lt;/VirtualHost&gt;\n\n&lt;VirtualHost *:443&gt;\n    ServerName yourdomain.com\n    ServerAlias www.yourdomain.com\n\n    # SSL Configuration\n    SSLEngine on\n    SSLCertificateFile /etc/letsencrypt/live/yourdomain.com/fullchain.pem\n    SSLCertificateKeyFile /etc/letsencrypt/live/yourdomain.com/privkey.pem\n\n    # WSGI Configuration\n    WSGIDaemonProcess mysite user=www-data group=www-data threads=5 \\\n        python-home=/var/www/mysite/venv \\\n        python-path=/var/www/mysite\n    WSGIScriptAlias / /var/www/mysite/trellis.wsgi\n    WSGIProcessGroup mysite\n    WSGIApplicationGroup %{GLOBAL}\n\n    # Static files\n    Alias /static /var/www/mysite/venv/lib/python3.11/site-packages/trellis/static\n    &lt;Directory /var/www/mysite/venv/lib/python3.11/site-packages/trellis/static&gt;\n        Require all granted\n    &lt;/Directory&gt;\n\n    # Main application directory\n    &lt;Directory /var/www/mysite&gt;\n        Require all granted\n    &lt;/Directory&gt;\n\n    # Security headers\n    Header always set X-Frame-Options \"SAMEORIGIN\"\n    Header always set X-Content-Type-Options \"nosniff\"\n    Header always set X-XSS-Protection \"1; mode=block\"\n\n    # Logging\n    ErrorLog ${APACHE_LOG_DIR}/mysite_error.log\n    CustomLog ${APACHE_LOG_DIR}/mysite_access.log combined\n&lt;/VirtualHost&gt;\n</code></pre> <p>Enable site and modules: <pre><code>sudo a2enmod ssl rewrite headers wsgi\nsudo a2ensite mysite\nsudo apache2ctl configtest\nsudo systemctl restart apache2\n</code></pre></p>"},{"location":"reference/deployment/#ssl-certificate-lets-encrypt","title":"SSL Certificate (Let's Encrypt)","text":"<pre><code># Install certbot\nsudo apt install certbot python3-certbot-apache\n\n# Obtain certificate\nsudo certbot --apache -d yourdomain.com -d www.yourdomain.com\n\n# Auto-renewal is configured via cron\nsudo certbot renew --dry-run\n</code></pre>"},{"location":"reference/deployment/#nginx-uwsgi-deployment","title":"Nginx + uWSGI Deployment","text":""},{"location":"reference/deployment/#install-prerequisites_1","title":"Install Prerequisites","text":"<pre><code>sudo apt install nginx uwsgi uwsgi-plugin-python3\n</code></pre>"},{"location":"reference/deployment/#install-trellis_1","title":"Install Trellis","text":"<p>Same as Apache deployment above.</p>"},{"location":"reference/deployment/#configure-uwsgi","title":"Configure uWSGI","text":"<p>Create <code>/etc/uwsgi/apps-available/mysite.ini</code>:</p> <pre><code>[uwsgi]\nproject = mysite\nbase = /var/www\n\n# Flask application\nchdir = %(base)/%(project)\nmodule = trellis:create_app()\ncallable = application\n\n# Virtual environment\nhome = %(base)/%(project)/venv\n\n# Process management\nmaster = true\nprocesses = 4\nthreads = 2\nuid = www-data\ngid = www-data\n\n# Socket\nsocket = /run/uwsgi/%(project).sock\nchmod-socket = 660\nvacuum = true\n\n# Logging\nlogto = /var/log/uwsgi/%(project).log\n\n# Environment\nenv = DATA_DIR=/var/www/%(project)_data\n</code></pre> <p>Enable: <pre><code>sudo ln -s /etc/uwsgi/apps-available/mysite.ini /etc/uwsgi/apps-enabled/\nsudo systemctl restart uwsgi\n</code></pre></p>"},{"location":"reference/deployment/#configure-nginx","title":"Configure Nginx","text":"<p>Create <code>/etc/nginx/sites-available/mysite</code>:</p> <pre><code>upstream mysite_app {\n    server unix:/run/uwsgi/mysite.sock;\n}\n\nserver {\n    listen 80;\n    server_name yourdomain.com www.yourdomain.com;\n    return 301 https://$server_name$request_uri;\n}\n\nserver {\n    listen 443 ssl http2;\n    server_name yourdomain.com www.yourdomain.com;\n\n    # SSL\n    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;\n\n    # Security\n    add_header X-Frame-Options \"SAMEORIGIN\" always;\n    add_header X-Content-Type-Options \"nosniff\" always;\n    add_header X-XSS-Protection \"1; mode=block\" always;\n\n    # Static files\n    location /static {\n        alias /var/www/mysite/venv/lib/python3.11/site-packages/trellis/static;\n        expires 30d;\n    }\n\n    # Application\n    location / {\n        include uwsgi_params;\n        uwsgi_pass mysite_app;\n    }\n\n    # Logging\n    access_log /var/log/nginx/mysite_access.log;\n    error_log /var/log/nginx/mysite_error.log;\n}\n</code></pre> <p>Enable and restart: <pre><code>sudo ln -s /etc/nginx/sites-available/mysite /etc/nginx/sites-enabled/\nsudo nginx -t\nsudo systemctl restart nginx\n</code></pre></p>"},{"location":"reference/deployment/#systemd-service-alternative","title":"Systemd Service (Alternative)","text":"<p>For running with Gunicorn:</p> <p>Create <code>/etc/systemd/system/trellis-mysite.service</code>:</p> <pre><code>[Unit]\nDescription=Trellis CMS - My Site\nAfter=network.target\n\n[Service]\nUser=www-data\nGroup=www-data\nWorkingDirectory=/var/www/mysite\nEnvironment=\"DATA_DIR=/var/www/mysite_data\"\nEnvironmentFile=/var/www/mysite/.env\nExecStart=/var/www/mysite/venv/bin/gunicorn \\\n    --workers 4 \\\n    --bind unix:/run/trellis-mysite.sock \\\n    --access-logfile /var/log/trellis/mysite-access.log \\\n    --error-logfile /var/log/trellis/mysite-error.log \\\n    \"trellis:create_app()\"\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>Enable and start: <pre><code>sudo systemctl daemon-reload\nsudo systemctl enable trellis-mysite\nsudo systemctl start trellis-mysite\nsudo systemctl status trellis-mysite\n</code></pre></p>"},{"location":"reference/deployment/#firewall-configuration","title":"Firewall Configuration","text":"<pre><code># UFW (Ubuntu)\nsudo ufw allow 'Apache Full'\n# or\nsudo ufw allow 'Nginx Full'\n\n# firewalld (RHEL/CentOS)\nsudo firewall-cmd --permanent --add-service=http\nsudo firewall-cmd --permanent --add-service=https\nsudo firewall-cmd --reload\n</code></pre>"},{"location":"reference/deployment/#post-deployment-tasks","title":"Post-Deployment Tasks","text":""},{"location":"reference/deployment/#change-admin-password","title":"Change Admin Password","text":"<ol> <li>Visit <code>/auth/login</code></li> <li>Login with <code>admin</code> / <code>admin</code></li> <li>Go to profile and change password immediately</li> </ol>"},{"location":"reference/deployment/#create-additional-users","title":"Create Additional Users","text":"<p>Visit <code>/auth/users</code> (admin only) to create editor accounts.</p>"},{"location":"reference/deployment/#setup-backups","title":"Setup Backups","text":"<p>See Backup Strategy for detailed instructions.</p> <p>Quick setup: <pre><code># Create backup script\nsudo cp /var/www/mysite/docs/backup-trellis.sh /usr/local/bin/\nsudo chmod +x /usr/local/bin/backup-trellis.sh\n\n# Schedule daily backups\nsudo crontab -e\n# Add: 0 2 * * * /usr/local/bin/backup-trellis.sh\n</code></pre></p>"},{"location":"reference/deployment/#setup-monitoring","title":"Setup Monitoring","text":"<p>Install monitoring tools: <pre><code>sudo apt install monit\n</code></pre></p> <p>Configure Monit for Trellis: <pre><code>check process apache2 with pidfile /var/run/apache2/apache2.pid\n  start program = \"/bin/systemctl start apache2\"\n  stop program = \"/bin/systemctl stop apache2\"\n</code></pre></p>"},{"location":"reference/deployment/#updating-production","title":"Updating Production","text":"<pre><code>cd /var/www/mysite\n\n# Backup first\nsudo /usr/local/bin/backup-trellis.sh\n\n# Pull latest code\nsudo -u deploy git pull origin main\n\n# Update dependencies\nsudo -u www-data venv/bin/pip install --upgrade trellis-cms\n\n# Rebuild indexes\nsudo -u www-data venv/bin/trellis-search --rebuild\n\n# Restart web server\nsudo systemctl restart apache2\n# or\nsudo systemctl restart nginx\nsudo systemctl restart uwsgi\n</code></pre>"},{"location":"reference/deployment/#troubleshooting","title":"Troubleshooting","text":""},{"location":"reference/deployment/#500-internal-server-error","title":"500 Internal Server Error","text":"<p>Check logs: <pre><code>sudo tail -f /var/log/apache2/mysite_error.log\n# or\nsudo tail -f /var/log/nginx/mysite_error.log\n</code></pre></p> <p>Common issues: - Wrong DATA_DIR path - Database permissions - Missing .env file - Python import errors</p>"},{"location":"reference/deployment/#permission-denied","title":"Permission Denied","text":"<pre><code># Fix data directory permissions\nsudo chown -R www-data:www-data /var/www/mysite_data\nsudo chmod -R 775 /var/www/mysite_data\n\n# Fix database permissions\nsudo chmod 664 /var/www/mysite_data/*.db\n</code></pre>"},{"location":"reference/deployment/#static-files-not-loading","title":"Static Files Not Loading","text":"<p>Check static files path in Apache/Nginx config matches actual location: <pre><code>find /var/www/mysite/venv -name \"static\" -type d\n</code></pre></p> <p>Update config with correct path.</p>"},{"location":"reference/deployment/#database-locked","title":"Database Locked","text":"<pre><code># Check for stale processes\nps aux | grep trellis\n\n# Check database locks\nfuser /var/www/mysite_data/trellis_admin.db\n</code></pre>"},{"location":"reference/deployment/#security-hardening","title":"Security Hardening","text":""},{"location":"reference/deployment/#file-permissions","title":"File Permissions","text":"<pre><code># Code directory (read-only for www-data)\nsudo chown -R deploy:www-data /var/www/mysite\nsudo chmod -R 750 /var/www/mysite\n\n# Data directory (writable by www-data)\nsudo chown -R www-data:www-data /var/www/mysite_data\nsudo chmod -R 770 /var/www/mysite_data\n\n# Secure .env\nsudo chmod 600 /var/www/mysite/.env\nsudo chown www-data:www-data /var/www/mysite/.env\n</code></pre>"},{"location":"reference/deployment/#disable-debug-mode","title":"Disable Debug Mode","text":"<p>Ensure <code>.env</code> has: <pre><code>DEBUG=False\n</code></pre></p> <p>Never run with <code>DEBUG=True</code> in production!</p>"},{"location":"reference/deployment/#rate-limiting","title":"Rate Limiting","text":"<p>Install mod_evasive: <pre><code>sudo apt install libapache2-mod-evasive\n</code></pre></p> <p>Configure in Apache: <pre><code>&lt;IfModule mod_evasive20.c&gt;\n    DOSHashTableSize 3097\n    DOSPageCount 5\n    DOSSiteCount 50\n    DOSPageInterval 1\n    DOSSiteInterval 1\n    DOSBlockingPeriod 60\n&lt;/IfModule&gt;\n</code></pre></p>"},{"location":"reference/deployment/#fail2ban","title":"Fail2Ban","text":"<pre><code>sudo apt install fail2ban\n\n# Create filter for Trellis\nsudo nano /etc/fail2ban/filter.d/trellis.conf\n</code></pre> <p>Add: <pre><code>[Definition]\nfailregex = Failed login attempt.*&lt;HOST&gt;\nignoreregex =\n</code></pre></p>"},{"location":"reference/deployment/#performance-optimization","title":"Performance Optimization","text":""},{"location":"reference/deployment/#enable-caching","title":"Enable Caching","text":"<p>In Apache config: <pre><code>&lt;IfModule mod_expires.c&gt;\n    ExpiresActive On\n    ExpiresByType text/css \"access plus 1 month\"\n    ExpiresByType text/javascript \"access plus 1 month\"\n    ExpiresByType image/png \"access plus 1 year\"\n    ExpiresByType image/jpg \"access plus 1 year\"\n&lt;/IfModule&gt;\n</code></pre></p>"},{"location":"reference/deployment/#compression","title":"Compression","text":"<pre><code>&lt;IfModule mod_deflate.c&gt;\n    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript\n&lt;/IfModule&gt;\n</code></pre>"},{"location":"reference/deployment/#database-optimization","title":"Database Optimization","text":"<pre><code># Vacuum database periodically\nsqlite3 /var/www/mysite_data/trellis_admin.db \"VACUUM;\"\nsqlite3 /var/www/mysite_data/trellis_content.db \"VACUUM;\"\n</code></pre>"},{"location":"reference/deployment/#next-steps","title":"Next Steps","text":"<ul> <li>Backup Strategy - Set up backups</li> <li>Search Indexing - Manage indexes</li> <li>Architecture - Understand the system</li> </ul>"},{"location":"reference/development/","title":"Development Setup","text":"<p>Guide for developers working on Trellis or its dependencies.</p>"},{"location":"reference/development/#for-users","title":"For Users","text":"<p>If you just want to use Trellis, see the Quick Start guide instead.</p>"},{"location":"reference/development/#for-developers","title":"For Developers","text":"<p>This section is for developers who want to: - Contribute to Trellis - Develop custom features - Work on the codebase locally - Develop qdflask or qdcomments packages</p>"},{"location":"reference/development/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.9+</li> <li>Git</li> <li>Code editor (VS Code, PyCharm, etc.)</li> <li>Basic Flask knowledge</li> </ul>"},{"location":"reference/development/#clone-the-repository","title":"Clone the Repository","text":"<pre><code>git clone https://github.com/almargolis/trellis.git\ncd trellis\n</code></pre>"},{"location":"reference/development/#development-installation","title":"Development Installation","text":""},{"location":"reference/development/#option-1-standard-development-setup","title":"Option 1: Standard Development Setup","text":"<p>Install Trellis in editable mode:</p> <pre><code># Create virtual environment\npython3 -m venv venv\nsource venv/bin/activate  # or venv\\Scripts\\activate on Windows\n\n# Install in editable mode with dev dependencies\npip install -e .\npip install -e \".[dev]\"\n</code></pre> <p>This installs: - Trellis in editable mode (changes take effect immediately) - All dependencies from PyPI (including qdflask, qdcomments) - Development tools (pytest, pytest-cov)</p>"},{"location":"reference/development/#option-2-full-development-setup-working-on-dependencies","title":"Option 2: Full Development Setup (Working on Dependencies)","text":""},{"location":"reference/development/#working-with-quickdev-dependencies","title":"Working with Quickdev Dependencies","text":"<p>If you're developing features that span both the application and quickdev packages (qdflask, qdcomments, etc.), use editable installations:</p> <pre><code># Clone quickdev repository\ngit clone https://github.com/almargolis/quickdev.git\n\n# In your application virtual environment\nsource venv/bin/activate\n\n# Install quickdev packages in editable mode\npip install -e ../quickdev/qdflask\npip install -e ../quickdev/qdcomments\n\n# Changes to quickdev packages take effect immediately\n</code></pre> <p>Directory structure: <pre><code>Projects/\n  your-app/\n    venv/\n    your-app/\n  quickdev/\n    qdflask/\n    qdcomments/\n</code></pre></p> <p>Benefits: - Changes in quickdev packages take effect immediately (no reinstall needed) - Easy to test changes across application and dependencies - Git workflow works in both repos independently</p> <p>Switching back to PyPI versions: <pre><code>pip uninstall qdflask qdcomments\npip install qdflask qdcomments\n</code></pre></p>"},{"location":"reference/development/#option-3-development-with-local-qdbase","title":"Option 3: Development with Local qdbase","text":"<p>If you need to work on qdbase as well:</p> <pre><code># In Trellis virtual environment\nsource venv/bin/activate\n\n# Install qdbase in editable mode\npip install -e ../quickdev/qdbase\npip install -e ../quickdev/qdflask\npip install -e ../quickdev/qdcomments\n\n# Install Trellis\npip install -e .\n</code></pre>"},{"location":"reference/development/#initial-setup","title":"Initial Setup","text":""},{"location":"reference/development/#initialize-test-data","title":"Initialize Test Data","text":"<pre><code># Create test data directory\nmkdir test-site\ncd test-site\n\n# Initialize database\ntrellis-init-db\n\n# Create sample garden\nmkdir -p content/blog\ncat &gt; content/blog/config.yaml &lt;&lt;EOF\ntitle: Test Blog\ndescription: Test content for development\ncreated_date: null\norder: 1\nEOF\n\n# Create sample article\ncat &gt; content/blog/test.md &lt;&lt;'EOF'\n---\ntitle: Test Article\npublished_date: 2026-01-09\ntags: [test]\nstatus: published\n---\n\nThis is a test article.\nEOF\n\n# Build search index\ntrellis-search --rebuild\n\n# Return to trellis directory\ncd ..\n</code></pre>"},{"location":"reference/development/#configure-environment","title":"Configure Environment","text":"<p>Create <code>.env</code> in your test-site directory:</p> <pre><code>SECRET_KEY=dev-secret-key-change-in-production\nSITE_NAME=Trellis Dev\nSITE_AUTHOR=Developer\nDEBUG=True\nDATA_DIR=.\n</code></pre>"},{"location":"reference/development/#running-development-server","title":"Running Development Server","text":""},{"location":"reference/development/#option-1-flask-cli","title":"Option 1: Flask CLI","text":"<pre><code>cd test-site\npython -m flask --app trellis run --debug\n</code></pre>"},{"location":"reference/development/#option-2-custom-runpy","title":"Option 2: Custom run.py","text":"<p>Create <code>test-site/run.py</code>:</p> <pre><code>from trellis import create_app\nimport os\n\n# Point to this directory\nos.environ['DATA_DIR'] = os.path.dirname(os.path.abspath(__file__))\n\napp = create_app()\n\nif __name__ == '__main__':\n    app.run(debug=True, host='0.0.0.0', port=5000)\n</code></pre> <p>Run it: <pre><code>cd test-site\npython run.py\n</code></pre></p>"},{"location":"reference/development/#project-structure","title":"Project Structure","text":"<pre><code>trellis/\n  trellis/                 # Main package\n    __init__.py           # App factory\n    routes.py             # Route handlers\n    config.py             # Configuration\n    cli.py                # CLI commands\n    models/               # Database models\n      __init__.py\n      user.py\n      comment.py\n    utils/                # Utility modules\n      markdown_handler.py\n      garden_manager.py\n      git_handler.py\n      search_handler.py\n      date_manager.py\n      index_manager.py\n    templates/            # Jinja2 templates\n    static/               # CSS, JavaScript\n  tests/                  # Test suite\n  docs/                   # MkDocs documentation\n  mkdocs.yml             # MkDocs config\n  pyproject.toml         # Package configuration\n  README.md\n  CLAUDE.md              # Developer guide\n</code></pre>"},{"location":"reference/development/#development-workflow","title":"Development Workflow","text":""},{"location":"reference/development/#making-changes","title":"Making Changes","text":"<pre><code># Make changes to code\nvim trellis/routes.py\n\n# Changes take effect immediately (editable install)\n# Restart Flask server to see changes\n\n# Test manually\n# Visit http://localhost:5000\n</code></pre>"},{"location":"reference/development/#running-tests","title":"Running Tests","text":"<pre><code># Run all tests\npytest\n\n# Run with coverage\npytest --cov=trellis\n\n# Run specific test\npytest tests/test_routes.py::test_garden_view\n\n# Run with verbose output\npytest -v\n</code></pre>"},{"location":"reference/development/#code-style","title":"Code Style","text":"<pre><code># Install development tools\npip install flake8 black isort\n\n# Check style\nflake8 trellis/\n\n# Format code\nblack trellis/\nisort trellis/\n</code></pre>"},{"location":"reference/development/#git-workflow","title":"Git Workflow","text":"<pre><code># Create feature branch\ngit checkout -b feature/my-feature\n\n# Make changes and commit\ngit add .\ngit commit -m \"Add my feature\"\n\n# Push to GitHub\ngit push origin feature/my-feature\n\n# Create pull request on GitHub\n</code></pre>"},{"location":"reference/development/#database-development","title":"Database Development","text":""},{"location":"reference/development/#sqlite-browser","title":"SQLite Browser","text":"<pre><code># Install SQLite browser (optional)\nbrew install --cask db-browser-for-sqlite  # macOS\n\n# Open database\nopen trellis_admin.db\n</code></pre>"},{"location":"reference/development/#database-migrations","title":"Database Migrations","text":"<p>Currently, Trellis uses simple schema creation via <code>db.create_all()</code>. For future migrations:</p> <pre><code># In trellis/cli.py\ndef upgrade_database():\n    \"\"\"Apply database migrations\"\"\"\n    # Migration logic here\n    pass\n</code></pre>"},{"location":"reference/development/#reset-database","title":"Reset Database","text":"<pre><code>cd test-site\nrm trellis_admin.db trellis_content.db\nrm -rf search_index/\ntrellis-init-db\ntrellis-search --rebuild\n</code></pre>"},{"location":"reference/development/#debugging","title":"Debugging","text":""},{"location":"reference/development/#flask-debug-mode","title":"Flask Debug Mode","text":"<p>In <code>run.py</code>: <pre><code>app.run(debug=True, host='0.0.0.0', port=5000)\n</code></pre></p> <p>Enables: - Auto-reload on code changes - Interactive debugger in browser - Detailed error pages</p>"},{"location":"reference/development/#logging","title":"Logging","text":"<p>Add logging to your code:</p> <pre><code>import logging\n\nlogger = logging.getLogger(__name__)\nlogger.info(\"Processing article: %s\", article_path)\nlogger.error(\"Failed to save: %s\", error)\n</code></pre> <p>Configure logging level:</p> <pre><code># In create_app()\nlogging.basicConfig(level=logging.DEBUG)\n</code></pre>"},{"location":"reference/development/#vs-code-debugging","title":"VS Code Debugging","text":"<p>Create <code>.vscode/launch.json</code>:</p> <pre><code>{\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    {\n      \"name\": \"Python: Flask\",\n      \"type\": \"python\",\n      \"request\": \"launch\",\n      \"module\": \"flask\",\n      \"env\": {\n        \"FLASK_APP\": \"trellis\",\n        \"FLASK_ENV\": \"development\",\n        \"DATA_DIR\": \"${workspaceFolder}/test-site\"\n      },\n      \"args\": [\"run\", \"--debug\", \"--no-reload\"],\n      \"jinja\": true,\n      \"justMyCode\": false\n    }\n  ]\n}\n</code></pre>"},{"location":"reference/development/#pycharm-debugging","title":"PyCharm Debugging","text":"<ol> <li>Create Flask run configuration</li> <li>Set module: <code>flask</code></li> <li>Set parameters: <code>run --debug</code></li> <li>Set environment variable: <code>DATA_DIR=/path/to/test-site</code></li> </ol>"},{"location":"reference/development/#testing","title":"Testing","text":""},{"location":"reference/development/#writing-tests","title":"Writing Tests","text":"<p>Create test in <code>tests/</code>:</p> <pre><code># tests/test_markdown_handler.py\nimport pytest\nfrom trellis.utils.markdown_handler import MarkdownHandler\n\ndef test_parse_frontmatter():\n    content = \"\"\"---\ntitle: Test\n---\nBody\"\"\"\n\n    handler = MarkdownHandler(\"/tmp\")\n    metadata, body = handler.parse_file_content(content)\n\n    assert metadata['title'] == \"Test\"\n    assert body.strip() == \"Body\"\n</code></pre> <p>Run it: <pre><code>pytest tests/test_markdown_handler.py\n</code></pre></p>"},{"location":"reference/development/#test-fixtures","title":"Test Fixtures","text":"<pre><code># tests/conftest.py\nimport pytest\nimport tempfile\nimport os\n\n@pytest.fixture\ndef temp_content_dir():\n    \"\"\"Create temporary content directory\"\"\"\n    with tempfile.TemporaryDirectory() as tmpdir:\n        # Set up test content\n        os.makedirs(f\"{tmpdir}/blog\")\n        with open(f\"{tmpdir}/blog/config.yaml\", 'w') as f:\n            f.write(\"title: Test\\ndescription: Test\\n\")\n\n        yield tmpdir\n</code></pre> <p>Use in tests: <pre><code>def test_garden_list(temp_content_dir):\n    manager = GardenManager(temp_content_dir)\n    gardens = manager.list_gardens()\n    assert len(gardens) &gt; 0\n</code></pre></p>"},{"location":"reference/development/#documentation-development","title":"Documentation Development","text":""},{"location":"reference/development/#building-docs","title":"Building Docs","text":"<pre><code># Install MkDocs\npip install mkdocs mkdocs-material\n\n# Serve docs locally\nmkdocs serve\n\n# Visit http://localhost:8000\n\n# Build static docs\nmkdocs build\n</code></pre>"},{"location":"reference/development/#documentation-structure","title":"Documentation Structure","text":"<pre><code>docs/\n  index.md                      # Home page\n  getting-started/\n    quickstart.md\n    installation.md\n    first-garden.md\n  content/\n    writing.md\n    structure.md\n    wiki-links.md\n    page-directories.md\n  maintenance/\n    backup.md\n    indexing.md\n    updates.md\n  reference/\n    architecture.md\n    development.md              # This file\n    deployment.md\n    api.md\n</code></pre>"},{"location":"reference/development/#dependencies","title":"Dependencies","text":""},{"location":"reference/development/#runtime-dependencies","title":"Runtime Dependencies","text":"<p>Defined in <code>pyproject.toml</code>:</p> <pre><code>dependencies = [\n    \"Flask&gt;=3.0.0\",\n    \"Flask-Login&gt;=0.6.3\",\n    \"Flask-SQLAlchemy&gt;=3.1.1\",\n    \"Markdown&gt;=3.5.1\",\n    \"Pygments&gt;=2.17.2\",\n    \"python-dotenv&gt;=1.0.0\",\n    \"PyYAML&gt;=6.0.1\",\n    \"GitPython&gt;=3.1.40\",\n    \"python-frontmatter&gt;=1.1.0\",\n    \"Werkzeug&gt;=3.0.0\",\n    \"Whoosh&gt;=2.7.4\",\n    \"qdflask\",\n    \"qdcomments\",\n]\n</code></pre>"},{"location":"reference/development/#development-dependencies","title":"Development Dependencies","text":"<pre><code>[project.optional-dependencies]\ndev = [\n    \"pytest&gt;=7.0.0\",\n    \"pytest-cov&gt;=4.0.0\",\n    \"flake8&gt;=6.0.0\",\n    \"black&gt;=23.0.0\",\n    \"isort&gt;=5.12.0\",\n]\n</code></pre>"},{"location":"reference/development/#updating-dependencies","title":"Updating Dependencies","text":"<pre><code># Update all dependencies\npip install --upgrade -e .\n\n# Update specific dependency\npip install --upgrade Flask\n\n# Check for outdated packages\npip list --outdated\n</code></pre>"},{"location":"reference/development/#contributing","title":"Contributing","text":""},{"location":"reference/development/#before-submitting-pr","title":"Before Submitting PR","text":"<ul> <li>[ ] Run tests: <code>pytest</code></li> <li>[ ] Check code style: <code>flake8 trellis/</code></li> <li>[ ] Format code: <code>black trellis/ &amp;&amp; isort trellis/</code></li> <li>[ ] Update documentation if needed</li> <li>[ ] Add tests for new features</li> <li>[ ] Update CHANGELOG.md</li> </ul>"},{"location":"reference/development/#commit-messages","title":"Commit Messages","text":"<p>Follow conventional commits:</p> <pre><code>feat: Add new feature\nfix: Fix bug\ndocs: Update documentation\ntest: Add tests\nrefactor: Refactor code\nchore: Update dependencies\n</code></pre> <p>Examples: <pre><code>feat: Add wiki-link support\nfix: Resolve search indexing race condition\ndocs: Add backup strategy guide\n</code></pre></p>"},{"location":"reference/development/#release-process","title":"Release Process","text":""},{"location":"reference/development/#creating-a-release","title":"Creating a Release","text":"<pre><code># Update version in pyproject.toml (setuptools_scm uses git tags)\n\n# Commit changes\ngit add .\ngit commit -m \"Prepare v0.3.0 release\"\n\n# Create tag\ngit tag -a v0.3.0 -m \"Release v0.3.0\"\n\n# Push tag\ngit push origin v0.3.0\n\n# Build distribution\npython -m build\n\n# Upload to PyPI\npython -m twine upload dist/*\n</code></pre>"},{"location":"reference/development/#publishing-qdflaskqdcomments","title":"Publishing qdflask/qdcomments","text":"<p>Before publishing Trellis, ensure dependencies are on PyPI:</p> <pre><code># In quickdev/qdflask\npython setup.py sdist bdist_wheel\ntwine upload dist/*\n\n# In quickdev/qdcomments\npython setup.py sdist bdist_wheel\ntwine upload dist/*\n</code></pre>"},{"location":"reference/development/#troubleshooting-development-issues","title":"Troubleshooting Development Issues","text":""},{"location":"reference/development/#import-errors","title":"Import Errors","text":"<pre><code># Reinstall in editable mode\npip uninstall trellis-cms\npip install -e .\n\n# Clear Python cache\nfind . -type d -name \"__pycache__\" -exec rm -rf {} +\n</code></pre>"},{"location":"reference/development/#database-locked","title":"Database Locked","text":"<pre><code># Kill running processes\npkill -f \"python.*trellis\"\n\n# Remove lock files\nrm *.db-journal\n</code></pre>"},{"location":"reference/development/#git-conflicts","title":"Git Conflicts","text":"<pre><code># Stash changes\ngit stash\n\n# Pull latest\ngit pull origin main\n\n# Reapply changes\ngit stash pop\n</code></pre>"},{"location":"reference/development/#next-steps","title":"Next Steps","text":"<ul> <li>Architecture - System design</li> <li>Deployment - Production setup</li> <li>API Reference - Code documentation</li> </ul>"}]}